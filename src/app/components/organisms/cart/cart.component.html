<div class="cart-container">
  <button class="cart-button" (click)="toggleCart()">
    <i class="bi bi-cart3"></i>
    @if (totalItems$ | async; as totalItems) {
      @if (totalItems > 0) {
        <span class="cart-badge">{{ totalItems }}</span>
      }
    }
  </button>

  @if (showCartDropdown) {
    <div class="cart-dropdown">
      <div class="cart-header">
        <h5 class="cart-title">Carrito</h5>
        <button class="btn-close-cart" (click)="toggleCart()">
          <i class="bi bi-x-lg"></i>
        </button>
      </div>

      <div class="cart-body">
        @if (cartItems$ | async; as items) {
          @if (items.length === 0) {
            <div class="empty-cart">
              <i class="bi bi-cart-x"></i>
              <p>Tu carrito está vacío</p>
            </div>
          } @else {
            <div class="cart-items">
              @for (item of items; track item.id) {
                <div class="cart-item">
                  <div class="item-info">
                    <h6 class="item-name">{{ item.productName }}</h6>
                    @if (item.selectedOptions.length > 0) {
                      <div class="item-options">
                        @for (option of item.selectedOptions; track option.id) {
                          <span class="option-tag">+{{ option.name }}</span>
                        }
                      </div>
                    }
                    <div class="item-price">
                      {{ item.totalPrice | currency:'COP':'symbol':'1.0-0' }}
                    </div>
                  </div>
                  <div class="item-controls">
                    <div class="quantity-controls">
                      <button 
                        class="quantity-btn" 
                        (click)="updateQuantity(item.id, item.quantity - 1)"
                        [disabled]="item.quantity <= 1">
                        <i class="bi bi-dash"></i>
                      </button>
                      <span class="quantity-value">{{ item.quantity }}</span>
                      <button 
                        class="quantity-btn" 
                        (click)="updateQuantity(item.id, item.quantity + 1)">
                        <i class="bi bi-plus"></i>
                      </button>
                    </div>
                    <button class="btn-remove-item" (click)="removeItem(item.id)">
                      <i class="bi bi-trash"></i>
                    </button>
                  </div>
                </div>
              }
            </div>

            <div class="cart-footer">
              <div class="cart-total">
                <span class="total-label">Total:</span>
                <span class="total-value">
                  @if (totalPrice$ | async; as totalPrice) {
                    {{ totalPrice | currency:'COP':'symbol':'1.0-0' }}
                  }
                </span>
              </div>
              <button class="btn-checkout" (click)="clearCart()">
                Finalizar Pedido
              </button>
            </div>
          }
        }
      </div>
    </div>
  }
</div>