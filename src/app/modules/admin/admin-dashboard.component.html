<section class="admin-dashboard">
  <div class="admin-container-wrapper">
    <!-- Overlay para m√≥vil -->
    <div class="sidebar-overlay" [class.active]="sidebarOpen && isMobile()" (click)="toggleSidebar()"></div>
    
    <div class="container-fluid admin-container">
    <!-- Navegaci√≥n Lateral -->
    <div class="admin-sidebar" [class.sidebar-open]="sidebarOpen">
      <nav class="admin-nav">
        <button
          class="nav-item"
          [class.active]="activeTab === 'dashboard'"
          (click)="setActiveTab('dashboard')">
          <i class="bi bi-speedometer2"></i>
          <span>Dashboard</span>
        </button>
        <button
          class="nav-item"
          [class.active]="activeTab === 'products'"
          (click)="setActiveTab('products')">
          <i class="bi bi-box-seam"></i>
          <span>Productos</span>
          <span class="badge">{{ stats.totalProducts }}</span>
        </button>
        <button
          class="nav-item"
          [class.active]="activeTab === 'orders'"
          (click)="setActiveTab('orders')">
          <i class="bi bi-receipt-cutoff"></i>
          <span>Pedidos</span>
          <span class="badge badge-warning" *ngIf="stats.pendingOrders > 0">{{ stats.pendingOrders }}</span>
        </button>
        <button
          class="nav-item"
          [class.active]="activeTab === 'categories'"
          (click)="setActiveTab('categories')">
          <i class="bi bi-folder"></i>
          <span>Categor√≠as</span>
        </button>
        <button
          class="nav-item"
          [class.active]="activeTab === 'inventory'"
          (click)="setActiveTab('inventory')">
          <i class="bi bi-boxes"></i>
          <span>Inventario</span>
        </button>
        <button
          class="nav-item"
          [class.active]="activeTab === 'reservations'"
          (click)="setActiveTab('reservations')">
          <i class="bi bi-calendar-check"></i>
          <span>Reservas</span>
          <span class="badge badge-warning" *ngIf="stats.pendingReservations > 0">{{ stats.pendingReservations }}</span>
        </button>
        <button
          class="nav-item"
          [class.active]="activeTab === 'extras'"
          (click)="setActiveTab('extras')">
          <i class="bi bi-plus-circle"></i>
          <span>Adicionales</span>
        </button>
        <button
          class="nav-item"
          [class.active]="activeTab === 'messages'"
          (click)="setActiveTab('messages')">
          <i class="bi bi-envelope"></i>
          <span>Mensajes</span>
          <span class="badge badge-warning" *ngIf="stats.unreadMessages > 0">{{ stats.unreadMessages }}</span>
        </button>
        <button
          class="nav-item"
          [class.active]="activeTab === 'customers'"
          (click)="setActiveTab('customers')">
          <i class="bi bi-people"></i>
          <span>Clientes</span>
          <span class="badge">{{ stats.totalCustomers }}</span>
        </button>
        <button
          class="nav-item"
          [class.active]="activeTab === 'settings'"
          (click)="setActiveTab('settings')">
          <i class="bi bi-gear"></i>
          <span>Configuraci√≥n</span>
        </button>
      </nav>
      <div class="sidebar-footer">
        <button class="nav-item nav-item-logout" (click)="logout()">
          <i class="bi bi-box-arrow-right"></i>
          <span>Salir</span>
        </button>
      </div>
    </div>

    <!-- Contenido Principal -->
    <div class="admin-content">
      <!-- Bot√≥n para abrir/cerrar sidebar en m√≥vil -->
      <button 
        class="mobile-sidebar-toggle" 
        *ngIf="isMobile()" 
        (click)="toggleSidebar()"
        [title]="sidebarOpen ? 'Cerrar men√∫' : 'Abrir men√∫'">
        <i class="bi" [ngClass]="sidebarOpen ? 'bi-x-lg' : 'bi-list'"></i>
      </button>
      
      <!-- Mensaje de Bienvenida -->
      <div class="welcome-section">
        <h1 class="welcome-title">
          <i class="bi bi-hand-thumbs-up"></i>
          Bienvenido, Administrador
        </h1>
        <p class="welcome-subtitle">Gestiona tu restaurante desde aqu√≠</p>
      </div>

      <!-- Tab: Dashboard -->
      <div *ngIf="activeTab === 'dashboard'" class="tab-content">
        <h2 class="section-title">Resumen General</h2>

        <!-- Tarjetas de Estad√≠sticas -->
        <div class="stats-grid">
          <div class="stat-card stat-primary">
            <div class="stat-icon">
              <i class="bi bi-receipt-cutoff"></i>
            </div>
            <div class="stat-info">
              <h3 class="stat-value">{{ stats.totalOrders }}</h3>
              <p class="stat-label">Total Pedidos</p>
            </div>
          </div>

          <div class="stat-card stat-warning">
            <div class="stat-icon">
              <i class="bi bi-hourglass-split"></i>
            </div>
            <div class="stat-info">
              <h3 class="stat-value">{{ stats.pendingOrders }}</h3>
              <p class="stat-label">Pedidos Pendientes</p>
            </div>
          </div>

          <div class="stat-card stat-success">
            <div class="stat-icon">
              <i class="bi bi-currency-dollar"></i>
            </div>
            <div class="stat-info">
              <h3 class="stat-value">${{ stats.totalRevenue | number:'1.0-0' }}</h3>
              <p class="stat-label">Ingresos Totales</p>
            </div>
          </div>

          <div class="stat-card stat-info">
            <div class="stat-icon">
              <i class="bi bi-box-seam"></i>
            </div>
            <div class="stat-info">
              <h3 class="stat-value">{{ stats.totalProducts }}</h3>
              <p class="stat-label">Productos Activos</p>
            </div>
          </div>

          <div class="stat-card stat-warning">
            <div class="stat-icon">
              <i class="bi bi-calendar-check"></i>
            </div>
            <div class="stat-info">
              <h3 class="stat-value">{{ stats.totalReservations }}</h3>
              <p class="stat-label">Total Reservas</p>
            </div>
          </div>

          <div class="stat-card stat-info">
            <div class="stat-icon">
              <i class="bi bi-hourglass-split"></i>
            </div>
            <div class="stat-info">
              <h3 class="stat-value">{{ stats.pendingReservations }}</h3>
              <p class="stat-label">Reservas Pendientes</p>
            </div>
          </div>

          <div class="stat-card stat-primary">
            <div class="stat-icon">
              <i class="bi bi-envelope"></i>
            </div>
            <div class="stat-info">
              <h3 class="stat-value">{{ stats.totalMessages }}</h3>
              <p class="stat-label">Total Mensajes</p>
            </div>
          </div>

          <div class="stat-card stat-warning">
            <div class="stat-icon">
              <i class="bi bi-envelope-exclamation"></i>
            </div>
            <div class="stat-info">
              <h3 class="stat-value">{{ stats.unreadMessages }}</h3>
              <p class="stat-label">Mensajes No Le√≠dos</p>
            </div>
          </div>
        </div>

        <!-- Pedidos Recientes -->
        <div class="recent-orders-card">
          <div class="card-header">
            <h3 class="card-title">Pedidos Recientes</h3>
            <button class="btn-link" (click)="setActiveTab('orders')">Ver Todos</button>
          </div>
          <div class="orders-table">
            <table>
              <thead>
                <tr>
                  <th>ID Pedido</th>
                  <th>Fecha</th>
                  <th>Cliente</th>
                  <th>Total</th>
                  <th>Estado</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let order of orders.slice(0, 5)">
                  <td>{{ order.id.slice(-8) }}</td>
                  <td>{{ formatDate(order.date) }}</td>
                  <td>{{ order.userName || order.deliveryPhone || order.deliveryAddress || 'N/A' }}</td>
                  <td>${{ order.total | number }}</td>
                  <td>
                    <span class="status-badge" [ngClass]="getOrderStatusClass(order.status)">
                      {{ getOrderStatusText(order.status) }}
                    </span>
                  </td>
                  <td>
                    <button class="btn-icon-small" (click)="selectedOrder = order; setActiveTab('orders')">
                      <i class="bi bi-eye"></i>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Tab: Productos -->
      <div *ngIf="activeTab === 'products'" class="tab-content">
        <div class="section-header">
          <h2 class="section-title">Gesti√≥n de Productos</h2>
          <div class="header-actions">
            <div class="view-toggle">
              <button
                class="view-toggle-btn"
                [class.active]="productViewMode === 'list'"
                (click)="productViewMode = 'list'"
                title="Vista de lista">
                <i class="bi bi-list-ul"></i>
              </button>
              <button
                class="view-toggle-btn"
                [class.active]="productViewMode === 'grid'"
                (click)="productViewMode = 'grid'"
                title="Vista de cuadr√≠cula">
                <i class="bi bi-grid-3x3-gap"></i>
              </button>
            </div>
            <button class="btn-primary" (click)="openProductModal()">
              <i class="bi bi-plus-lg"></i>
              Agregar Producto
            </button>
          </div>
        </div>

        <!-- Filtros y B√∫squeda -->
        <div class="filters-section">
          <input
            type="text"
            class="search-input"
            placeholder="Buscar productos..."
            [(ngModel)]="searchTerm" />
          <select class="filter-select" [(ngModel)]="categoryFilter">
            <option value="">Todas las categor√≠as</option>
            <option *ngFor="let cat of categories" [value]="cat.id">{{ cat.name }}</option>
          </select>
          <select class="filter-select" [(ngModel)]="availabilityFilter">
            <option value="all">Todos los productos</option>
            <option value="available">Solo disponibles</option>
            <option value="unavailable">Solo no disponibles</option>
          </select>
        </div>

        <!-- Vista de Lista -->
        <div *ngIf="productViewMode === 'list'" class="products-table-card">
          <table class="admin-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Categor√≠a</th>
                <th>Precio</th>
                <th>Estado</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let product of getFilteredProducts()">
                <td>{{ product.id }}</td>
                <td>{{ product.name }}</td>
                <td>{{ getCategoryName(product.categoryId) }}</td>
                <td>${{ product.price | number }}</td>
                <td>
                  <span class="status-badge" [class.status-success]="product.available" [class.status-danger]="!product.available">
                    {{ product.available ? 'Disponible' : 'No Disponible' }}
                  </span>
                </td>
                <td>
                  <div class="action-buttons">
                    <button class="btn-icon-small" (click)="viewProductDetails(product)" title="Ver">
                      <i class="bi bi-eye"></i>
                    </button>
                    <button class="btn-icon-small" (click)="openProductModal(product)" title="Editar">
                      <i class="bi bi-pencil"></i>
                    </button>
                    <button class="btn-icon-small" (click)="toggleProductAvailability(product)"
                            [title]="product.available ? 'Desactivar' : 'Activar'">
                      <i class="bi" [class.bi-toggle-on]="product.available" [class.bi-toggle-off]="!product.available"></i>
                    </button>
                    <button class="btn-icon-small btn-danger" (click)="deleteProduct(product.id)" title="Eliminar">
                      <i class="bi bi-trash"></i>
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Vista de Grid -->
        <div *ngIf="productViewMode === 'grid'" class="products-grid-view">
          <div class="products-grid">
            <div *ngFor="let product of getFilteredProducts()" class="product-card-grid">
              <div class="product-card-image">
                <img [src]="product.imageUrl || 'https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=600&q=80'"
                     [alt]="product.name"
                     class="product-image" />
                <div class="product-card-overlay">
                  <span class="status-badge" [class.status-success]="product.available" [class.status-danger]="!product.available">
                    {{ product.available ? 'Disponible' : 'No Disponible' }}
                  </span>
                </div>
              </div>
              <div class="product-card-body">
                <div class="product-card-header">
                  <span class="product-id">#{{ product.id }}</span>
                  <span class="product-price">${{ product.price | number }}</span>
                </div>
                <h3 class="product-name">{{ product.name }}</h3>
                <p class="product-description">{{ product.description }}</p>
                <div class="product-category">
                  <i class="bi bi-folder"></i>
                  <span>{{ getCategoryName(product.categoryId) }}</span>
                </div>
                <div class="product-card-actions">
                  <button class="btn-icon-small" (click)="viewProductDetails(product)" title="Ver">
                    <i class="bi bi-eye"></i>
                  </button>
                  <button class="btn-icon-small" (click)="openProductModal(product)" title="Editar">
                    <i class="bi bi-pencil"></i>
                  </button>
                  <button class="btn-icon-small" (click)="toggleProductAvailability(product)"
                          [title]="product.available ? 'Desactivar' : 'Activar'">
                    <i class="bi" [class.bi-toggle-on]="product.available" [class.bi-toggle-off]="!product.available"></i>
                  </button>
                  <button class="btn-icon-small btn-danger" (click)="deleteProduct(product.id)" title="Eliminar">
                    <i class="bi bi-trash"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Tab: Pedidos -->
      <div *ngIf="activeTab === 'orders'" class="tab-content">
        <div class="section-header">
          <h2 class="section-title">Gesti√≥n de Pedidos</h2>
        </div>

        <!-- Filtros y Controles -->
        <div class="filters-section">
          <div class="filters-top-row">
            <div class="filter-tabs">
              <button class="filter-tab" [class.active]="orderFilter === 'all'" (click)="orderFilter = 'all'">
                Todos ({{ orders.length }})
              </button>
              <button class="filter-tab" [class.active]="orderFilter === 'pending'" (click)="orderFilter = 'pending'">
                Pendientes ({{ pendingOrdersCount }})
              </button>
              <button class="filter-tab" [class.active]="orderFilter === 'preparing'" (click)="orderFilter = 'preparing'">
                En Preparaci√≥n ({{ preparingOrdersCount }})
              </button>
              <button class="filter-tab" [class.active]="orderFilter === 'ready'" (click)="orderFilter = 'ready'">
                Listos ({{ readyOrdersCount }})
              </button>
              <button class="filter-tab" [class.active]="orderFilter === 'delivered'" (click)="orderFilter = 'delivered'">
                Entregados ({{ deliveredOrdersCount }})
              </button>
            </div>
            <div class="filters-actions">
              <input
                type="text"
                class="search-input"
                placeholder="Buscar pedidos..."
                [(ngModel)]="searchTerm" />
              <button
                class="btn-sm btn-outline-danger"
                (click)="clearAllOrders()"
                title="Eliminar todos los pedidos del localStorage">
                <i class="bi bi-trash me-1"></i>
                Limpiar Pedidos Locales
              </button>
              <div class="view-mode-toggle">
                <button
                  class="view-mode-btn"
                  [class.active]="orderViewMode === 'list'"
                  (click)="orderViewMode = 'list'"
                  title="Vista de lista">
                  <i class="bi bi-list-ul"></i>
                </button>
                <button
                  class="view-mode-btn"
                  [class.active]="orderViewMode === 'grid'"
                  (click)="orderViewMode = 'grid'"
                  title="Vista de cuadr√≠cula">
                  <i class="bi bi-grid-3x3-gap"></i>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Lista de Pedidos -->
        <div class="orders-container-admin" [ngClass]="'view-' + orderViewMode">
          <div *ngFor="let order of getFilteredOrders(); trackBy: trackByOrderId"
               class="order-card-admin"
               [class.order-card-grid]="orderViewMode === 'grid'"
               [class.order-card-list]="orderViewMode === 'list'">
            <div class="order-header-admin">
              <div class="order-info-admin">
                <div class="order-id-row-admin">
                  <span class="order-id-admin">Pedido #{{ order.id.slice(-8) }}</span>
                  <span class="order-tracking-code-admin" *ngIf="order.trackingCode">
                    <i class="bi bi-qr-code me-1"></i>
                    {{ order.trackingCode }}
                  </span>
                </div>
                <span class="order-date-admin">{{ formatDate(order.date) }}</span>
                <div class="order-customer-info" *ngIf="order.userName || order.deliveryPhone || order.deliveryAddress">
                  <i class="bi bi-person me-1"></i>
                  <span *ngIf="order.userName" class="customer-name">{{ order.userName }}</span>
                  <span *ngIf="order.deliveryPhone && !order.userName">{{ order.deliveryPhone }}</span>
                  <span *ngIf="order.deliveryPhone && order.userName"> ‚Ä¢ {{ order.deliveryPhone }}</span>
                  <span *ngIf="order.deliveryAddress"> ‚Ä¢ {{ order.deliveryAddress }}</span>
                </div>
                <div class="order-type-badge" *ngIf="order.orderType">
                  <i class="bi" [class.bi-shop]="order.orderType === 'pickup'" [class.bi-truck]="order.orderType === 'delivery'"></i>
                  {{ order.orderType === 'pickup' ? 'Recoger en Restaurante' : 'Entrega a Domicilio' }}
                </div>
              </div>
              <span class="status-badge" [ngClass]="getOrderStatusClass(order.status)">
                {{ getOrderStatusText(order.status) }}
              </span>
            </div>

            <div class="order-items-admin" *ngIf="orderViewMode === 'list' || orderViewMode === 'grid'">
              <div *ngFor="let item of order.items; let itemIndex = index"
                   class="order-item-admin"
                   [class.item-unavailable]="item.unavailable">
                <div class="item-details-admin">
                  <div class="item-main-info">
                    <span class="item-name-admin">
                      {{ item.name }}
                    </span>
                    <span class="item-quantity-admin">x{{ item.quantity }}</span>
                    <span class="item-price-admin">${{ (item.price * item.quantity) | number }}</span>
                    <button class="btn-unavailable"
                            *ngIf="!item.unavailable && order.status !== 'delivered' && order.status !== 'cancelled'"
                            (click)="markItemAsUnavailable(order, item, itemIndex)"
                            title="Marcar como no disponible">
                      <i class="bi bi-x-circle"></i>
                      No disponible
                    </button>
                  </div>
                  <div class="unavailable-reason" *ngIf="item.unavailable && item.unavailableReason">
                    <i class="bi bi-info-circle me-1"></i>
                    <span>{{ item.unavailableReason }}</span>
                  </div>
                  <div class="item-options-admin" *ngIf="item.selectedOptions && item.selectedOptions.length > 0">
                    <div *ngFor="let option of item.selectedOptions" class="option-badge-admin">
                      <i class="bi bi-plus-circle me-1"></i>
                      <span class="option-name">{{ option.name }}</span>
                      <span class="option-price" *ngIf="option.price > 0">+${{ option.price | number }}</span>
                    </div>
                  </div>
                  <div class="item-notes-admin" *ngIf="item.notes">
                    <i class="bi bi-chat-left-text me-1"></i>
                    <span>{{ item.notes }}</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Vista compacta para cuadr√≠cula -->
            <div class="order-items-compact" *ngIf="orderViewMode === 'grid'">
              <div class="items-count-badge">
                <i class="bi bi-bag-check me-1"></i>
                {{ order.items.length }} {{ order.items.length === 1 ? 'item' : 'items' }}
              </div>
              <div class="order-total-compact">
                <span class="total-label-compact">Total:</span>
                <span class="total-value-compact">${{ order.total | number }}</span>
              </div>
            </div>

            <div class="order-summary-admin" *ngIf="order.subtotal || order.additionalFees">
              <div class="summary-row" *ngIf="order.subtotal">
                <span>Subtotal:</span>
                <span>${{ (order.subtotal || 0) | number }}</span>
              </div>
              <div class="summary-row" *ngIf="order.additionalFees">
                <span>Costos adicionales:</span>
                <span>${{ (order.additionalFees || 0) | number }}</span>
              </div>
            </div>

            <div class="order-footer-admin">
              <div class="order-total-admin">
                <span class="total-label">Total:</span>
                <span class="total-value">${{ order.total | number }}</span>
              </div>
              <div class="order-actions-admin">
                <div class="action-buttons-group">
                  <button class="action-btn btn-view" (click)="viewOrderDetails(order)" title="Ver detalles">
                    <i class="bi bi-eye"></i>
                    <span *ngIf="orderViewMode === 'list'">Ver</span>
                  </button>
                  <button class="action-btn btn-print" (click)="printOrder(order)" title="Imprimir">
                    <i class="bi bi-printer"></i>
                    <span *ngIf="orderViewMode === 'list'">Imprimir</span>
                  </button>
                  <div class="status-select-wrapper">
                    <select class="status-select" [value]="order.status"
                            (change)="updateOrderStatus(order, $any($event.target).value)">
                      <option value="pending">‚è≥ Pendiente</option>
                      <option value="preparing">üë®‚Äçüç≥ Preparando</option>
                      <option value="ready">‚úÖ Listo</option>
                      <option value="delivered">üöö Entregado</option>
                      <option value="cancelled">‚ùå Cancelado</option>
                    </select>
                    <i class="bi bi-chevron-down status-select-icon"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Modal de Detalles del Pedido -->
        <div class="modal-overlay" *ngIf="showOrderDetailsModal && selectedOrder" (click)="closeOrderDetailsModal()">
          <div class="modal-content order-details-modal" (click)="$event.stopPropagation()">
            <div class="modal-header">
              <h3>Detalles del Pedido #{{ selectedOrder.id.slice(-8) }}</h3>
              <button class="modal-close-btn" (click)="closeOrderDetailsModal()">
                <i class="bi bi-x-lg"></i>
              </button>
            </div>
            <div class="modal-body">
              <div class="order-details-section">
                <h4>Informaci√≥n General</h4>
                <div class="details-grid">
                  <div class="detail-item">
                    <span class="detail-label">Fecha:</span>
                    <span class="detail-value">{{ formatDate(selectedOrder.date) }}</span>
                  </div>
                  <div class="detail-item">
                    <span class="detail-label">Cliente:</span>
                    <span class="detail-value">{{ selectedOrder.userName || 'N/A' }}</span>
                  </div>
                  <div class="detail-item">
                    <span class="detail-label">Estado:</span>
                    <span class="status-badge" [ngClass]="getOrderStatusClass(selectedOrder.status)">
                      {{ getOrderStatusText(selectedOrder.status) }}
                    </span>
                  </div>
                  <div class="detail-item">
                    <span class="detail-label">Tipo:</span>
                    <span class="detail-value">{{ selectedOrder.orderType === 'pickup' ? 'Recoger' : 'Entrega' }}</span>
                  </div>
                </div>
              </div>
              <div class="order-details-section">
                <h4>Items del Pedido</h4>
                <div class="order-items-admin">
                  <div *ngFor="let item of selectedOrder.items" class="order-item-admin">
                    <div class="item-details-admin">
                      <div class="item-main-info">
                        <span class="item-name-admin">{{ item.name }}</span>
                        <span class="item-quantity-admin">x{{ item.quantity }}</span>
                        <span class="item-price-admin">${{ (item.price * item.quantity) | number }}</span>
                      </div>
                      <div class="item-options-admin" *ngIf="item.selectedOptions && item.selectedOptions.length > 0">
                        <div *ngFor="let option of item.selectedOptions" class="option-badge-admin">
                          <i class="bi bi-plus-circle me-1"></i>
                          <span class="option-name">{{ option.name }}</span>
                          <span class="option-price" *ngIf="option.price > 0">+${{ option.price | number }}</span>
                        </div>
                      </div>
                      <div class="item-notes-admin" *ngIf="item.notes">
                        <i class="bi bi-chat-left-text me-1"></i>
                        <span>{{ item.notes }}</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="order-details-section" *ngIf="selectedOrder.subtotal || selectedOrder.additionalFees">
                <h4>Resumen Financiero</h4>
                <div class="order-summary-admin">
                  <div class="summary-row" *ngIf="selectedOrder.subtotal">
                    <span>Subtotal:</span>
                    <span>${{ (selectedOrder.subtotal || 0) | number }}</span>
                  </div>
                  <div class="summary-row" *ngIf="selectedOrder.additionalFees">
                    <span>Costos adicionales:</span>
                    <span>${{ (selectedOrder.additionalFees || 0) | number }}</span>
                  </div>
                  <div class="summary-row total-row">
                    <span>Total:</span>
                    <span class="total-value">${{ (selectedOrder.total || 0) | number }}</span>
                  </div>
                </div>
              </div>
            </div>
            <div class="modal-footer" *ngIf="selectedOrder">
              <button class="btn-primary" (click)="printOrder(selectedOrder)">
                <i class="bi bi-printer me-2"></i>
                Imprimir
              </button>
              <button class="btn-outline" (click)="closeOrderDetailsModal()">
                Cerrar
              </button>
            </div>
          </div>
        </div>

        <!-- Modal para Manejar Producto No Disponible -->
        <div class="modal-overlay" *ngIf="showUnavailableModal" (click)="closeUnavailableModal()">
          <div class="modal-content unavailable-modal" (click)="$event.stopPropagation()">
            <div class="modal-header">
              <h3>Producto No Disponible</h3>
              <button class="modal-close-btn" (click)="closeUnavailableModal()">
                <i class="bi bi-x-lg"></i>
              </button>
            </div>
            <div class="modal-body" *ngIf="selectedItemForUnavailable">
              <div class="unavailable-item-info">
                <p><strong>Producto:</strong> {{ selectedItemForUnavailable.item.name }}</p>
                <p><strong>Cantidad:</strong> {{ selectedItemForUnavailable.item.quantity }}</p>
                <p><strong>Pedido:</strong> #{{ selectedItemForUnavailable.order.id.slice(-8) }}</p>
              </div>

              <div class="unavailable-actions">
                <h4>¬øQu√© deseas hacer?</h4>

                <div class="action-option">
                  <button class="action-option-btn" (click)="handleUnavailableItem('cancel', 'Producto agotado')">
                    <i class="bi bi-x-circle"></i>
                    <div>
                      <strong>Cancelar Item</strong>
                      <small>Eliminar del pedido y ajustar el total</small>
                    </div>
                  </button>
                </div>

                <div class="action-option">
                  <button class="action-option-btn" (click)="handleUnavailableItem('notify', 'Producto no disponible temporalmente')">
                    <i class="bi bi-bell"></i>
                    <div>
                      <strong>Notificar al Cliente</strong>
                      <small>Marcar como no disponible y notificar al cliente</small>
                    </div>
                  </button>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button class="btn-outline" (click)="closeUnavailableModal()">
                Cancelar
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Tab: Categor√≠as -->
      <div *ngIf="activeTab === 'categories'" class="tab-content">
        <div class="section-header">
          <h2 class="section-title">Gesti√≥n de Categor√≠as</h2>
          <div class="header-actions">
            <button class="btn-primary" (click)="openCategoryModal()">
              <i class="bi bi-plus-lg"></i>
              Agregar Categor√≠a
            </button>
          </div>
        </div>

        <div class="categories-grid">
          <div *ngFor="let category of categories" class="category-card-admin">
            <div class="category-icon-admin">
              <i [class]="'bi ' + category.icon"></i>
            </div>
            <h3 class="category-name-admin">{{ category.name }}</h3>
            <p class="category-description-admin">{{ category.description }}</p>
            <div class="category-actions">
              <button class="btn-icon-small" (click)="openCategoryModal(category)" title="Editar">
                <i class="bi bi-pencil"></i>
              </button>
              <button class="btn-icon-small btn-danger" (click)="deleteCategory(category.id)" title="Eliminar">
                <i class="bi bi-trash"></i>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Tab: Inventario -->
      <div *ngIf="activeTab === 'inventory'" class="tab-content">
        <div class="section-header">
          <h2 class="section-title">Gesti√≥n de Inventario</h2>
          <button class="btn-primary" (click)="openSupplyModal()">
            <i class="bi bi-plus-lg me-2"></i>
            Agregar Insumo
          </button>
        </div>

        <!-- Filtros -->
        <div class="filters-section">
          <div class="filter-tabs">
            <button class="filter-tab" [class.active]="supplyFilter === 'all'" (click)="supplyFilter = 'all'; loadSupplies()">
              Todos
            </button>
            <button class="filter-tab" [class.active]="supplyFilter === 'low'" (click)="supplyFilter = 'low'; loadSupplies()">
              Stock Bajo
            </button>
            <button class="filter-tab" [class.active]="supplyFilter === 'out'" (click)="supplyFilter = 'out'; loadSupplies()">
              Agotados
            </button>
          </div>
        </div>

        <!-- Lista de Insumos -->
        <div class="supplies-list">
          <div *ngFor="let supply of supplies" class="supply-card">
            <div class="supply-header">
              <div class="supply-info">
                <h3 class="supply-name">{{ supply.name }}</h3>
                <p class="supply-description">{{ supply.description }}</p>
              </div>
              <span class="stock-badge" [ngClass]="getStockStatusClass(supply.quantity)">
                <i class="bi" [class.bi-exclamation-triangle]="supply.quantity === 0 || supply.quantity < lowStockThreshold"
                   [class.bi-check-circle]="supply.quantity >= lowStockThreshold"></i>
                {{ getStockStatusText(supply.quantity) }}
              </span>
            </div>
            <div class="supply-details">
              <div class="detail-item">
                <span class="detail-label">Cantidad:</span>
                <span class="detail-value" [ngClass]="getStockStatusClass(supply.quantity)">
                  {{ supply.quantity }}
                </span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Precio Unitario:</span>
                <span class="detail-value">${{ supply.unit_price | number }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Valor Total:</span>
                <span class="detail-value total-value">${{ (supply.quantity * supply.unit_price) | number }}</span>
              </div>
            </div>
            <div class="supply-actions">
              <button class="btn-icon-small" (click)="openSupplyModal(supply)" title="Editar">
                <i class="bi bi-pencil"></i>
              </button>
              <button class="btn-icon-small btn-danger" (click)="deleteSupply(supply._id || supply.id || '')" title="Eliminar">
                <i class="bi bi-trash"></i>
              </button>
            </div>
          </div>
        </div>

        <div *ngIf="supplies.length === 0" class="empty-state">
          <i class="bi bi-inbox empty-icon"></i>
          <h3>No hay insumos registrados</h3>
          <p>Agrega insumos para gestionar tu inventario</p>
          <button class="btn-primary" (click)="openSupplyModal()">
            <i class="bi bi-plus-lg me-2"></i>
            Agregar Primer Insumo
          </button>
        </div>
      </div>

      <!-- Tab: Reservas -->
      <div *ngIf="activeTab === 'reservations'" class="tab-content">
        <div class="section-header">
          <h2 class="section-title">Gesti√≥n de Reservas</h2>
        </div>

        <!-- Filtros y Controles -->
        <div class="filters-section">
          <div class="filters-top-row">
            <div class="filter-tabs">
              <button class="filter-tab" [class.active]="reservationFilter === 'all'" (click)="reservationFilter = 'all'">
                Todas ({{ reservations.length }})
              </button>
              <button class="filter-tab" [class.active]="reservationFilter === 'pending'" (click)="reservationFilter = 'pending'">
                Pendientes ({{ pendingReservationsCount }})
              </button>
              <button class="filter-tab" [class.active]="reservationFilter === 'confirmed'" (click)="reservationFilter = 'confirmed'">
                Confirmadas ({{ confirmedReservationsCount }})
              </button>
              <button class="filter-tab" [class.active]="reservationFilter === 'cancelled'" (click)="reservationFilter = 'cancelled'">
                Canceladas ({{ cancelledReservationsCount }})
              </button>
              <button class="filter-tab" [class.active]="reservationFilter === 'completed'" (click)="reservationFilter = 'completed'">
                Completadas ({{ completedReservationsCount }})
              </button>
            </div>
            <div class="filters-actions">
              <input
                type="text"
                class="search-input"
                placeholder="Buscar reservas..."
                [(ngModel)]="searchTerm" />
            </div>
          </div>
        </div>

        <!-- Lista de Reservas -->
        <div class="reservations-container-admin">
          <div *ngFor="let reservation of getFilteredReservations()" class="reservation-card-admin">
            <div class="reservation-header-admin">
              <div class="reservation-info-admin">
                <div class="reservation-id-row-admin">
                  <span class="reservation-id-admin">Mesa {{ reservation.tableNumber }}</span>
                  <span class="reservation-date-admin">
                    <i class="bi bi-calendar3 me-1"></i>
                    {{ reservation.date }}
                  </span>
                  <span class="reservation-time-admin">
                    <i class="bi bi-clock me-1"></i>
                    {{ reservation.time }}
                  </span>
                </div>
                <div class="reservation-customer-info">
                  <i class="bi bi-person me-1"></i>
                  <span class="customer-name">{{ reservation.userName }}</span>
                  <span class="customer-email"> ‚Ä¢ {{ reservation.userEmail }}</span>
                </div>
                <div class="reservation-people-info">
                  <i class="bi bi-people me-1"></i>
                  <span>{{ reservation.numberOfPeople }} {{ reservation.numberOfPeople === 1 ? 'persona' : 'personas' }}</span>
                </div>
                <div class="reservation-special-requests" [class.has-comments]="reservation.specialRequests" [class.no-comments]="!reservation.specialRequests">
                  <i class="bi bi-chat-left-text me-1"></i>
                  <span *ngIf="reservation.specialRequests">{{ reservation.specialRequests }}</span>
                  <span *ngIf="!reservation.specialRequests" class="no-comments-text">Sin comentarios adicionales</span>
                </div>
              </div>
              <span class="status-badge" [ngClass]="getReservationStatusClass(reservation.status)">
                {{ getReservationStatusText(reservation.status) }}
              </span>
            </div>

            <div class="reservation-actions-admin">
              <button
                class="btn-success"
                *ngIf="reservation.status === 'pending'"
                (click)="confirmReservation(reservation)"
                title="Confirmar reserva">
                <i class="bi bi-check-circle me-1"></i>
                Confirmar
              </button>
              <button
                class="btn-warning"
                *ngIf="reservation.status === 'pending' || reservation.status === 'confirmed'"
                (click)="openCancelReservationModal(reservation)"
                title="Cancelar reserva">
                <i class="bi bi-x-circle me-1"></i>
                Cancelar
              </button>
              <button
                class="btn-info"
                *ngIf="reservation.status === 'confirmed'"
                (click)="completeReservation(reservation)"
                title="Marcar como completada">
                <i class="bi bi-check2-all me-1"></i>
                Completar
              </button>
              <span class="reservation-created-date" *ngIf="reservation.createdAt">
                Creada: {{ formatDate(reservation.createdAt) }}
              </span>
            </div>
          </div>
        </div>

        <div *ngIf="getFilteredReservations().length === 0" class="empty-state">
          <i class="bi bi-calendar-x empty-icon"></i>
          <h3>No hay reservas</h3>
          <p *ngIf="reservationFilter !== 'all'">No hay reservas con el estado seleccionado</p>
          <p *ngIf="reservationFilter === 'all'">A√∫n no se han realizado reservas</p>
        </div>
      </div>

      <!-- Tab: Adicionales -->
      <div *ngIf="activeTab === 'extras'" class="tab-content">
        <div class="section-header">
          <h2 class="section-title">
            <i class="bi bi-plus-circle me-2"></i>
            Gesti√≥n de Adicionales
          </h2>
          <div class="header-actions">
            <button class="btn-primary" (click)="openAddModal()" type="button">
              <i class="bi bi-plus-lg me-2"></i>
              Nuevo Adicional
            </button>
          </div>
        </div>

        <div class="alert alert-info">
          <i class="bi bi-info-circle me-2"></i>
          <strong>Nota:</strong> Los adicionales deshabilitados no aparecer√°n como opci√≥n para los clientes.
          Puedes asociar adicionales por categor√≠as (todos los productos de esa categor√≠a) o por productos espec√≠ficos.
          Tambi√©n puedes combinar ambos m√©todos.
        </div>

        <!-- Buscador -->
        <div class="search-section mb-3">
          <input
            type="text"
            class="form-control"
            placeholder="Buscar adicionales por nombre o descripci√≥n..."
            [(ngModel)]="addSearchTerm">
        </div>

        <!-- Grid de Adicionales -->
        <div class="extras-grid" *ngIf="filteredAdds.length > 0">
          <div *ngFor="let add of filteredAdds" class="extra-card" [class.unavailable]="!add.available">
            <div class="extra-card-header">
              <h3 class="extra-name">{{ add.name }}</h3>
              <span class="status-badge" [class.status-success]="add.available" [class.status-danger]="!add.available">
                {{ add.available ? 'Disponible' : 'No Disponible' }}
              </span>
            </div>
            <div class="extra-card-body">
              <p class="extra-description">
                {{ add.description || 'Sin descripci√≥n' }}
              </p>
              <div class="extra-categories mt-2" *ngIf="add.categoryIds && add.categoryIds.length > 0">
                <strong>Categor√≠as:</strong>
                <span class="category-tags">
                  {{ getCategoryNames(add.categoryIds) }}
                </span>
              </div>
              <div class="extra-products mt-2" *ngIf="add.dishIds && add.dishIds.length > 0">
                <strong>Productos espec√≠ficos:</strong>
                <span class="category-tags">
                  {{ getProductNames(add.dishIds) }}
                </span>
              </div>
              <div class="extra-categories mt-2" *ngIf="(!add.categoryIds || add.categoryIds.length === 0) && (!add.dishIds || add.dishIds.length === 0)">
                <span class="text-muted">Sin categor√≠as ni productos asignados</span>
              </div>
            </div>
            <div class="extra-card-footer">
              <div class="extra-price">
                <strong>Precio:</strong> ${{ add.price | number }}
              </div>
            </div>
            <div class="extra-card-actions">
              <button
                type="button"
                class="btn-icon-small btn-edit"
                (click)="openAddModal(add)"
                title="Editar">
                <i class="bi bi-pencil"></i>
              </button>
              <button
                type="button"
                class="btn-toggle"
                [class.btn-success]="add.available"
                [class.btn-danger]="!add.available"
                (click)="toggleAddAvailability(add)"
                title="{{ add.available ? 'Deshabilitar' : 'Habilitar' }}">
                <i class="bi" [class.bi-toggle-on]="add.available" [class.bi-toggle-off]="!add.available"></i>
              </button>
              <button
                type="button"
                class="btn-icon-small btn-danger btn-delete"
                (click)="deleteAdd(add)"
                title="Eliminar">
                <i class="bi bi-trash"></i>
              </button>
            </div>
          </div>
        </div>

        <div *ngIf="filteredAdds.length === 0 && adds.length === 0" class="empty-state">
          <i class="bi bi-plus-circle empty-icon"></i>
          <h3>No hay adicionales registrados</h3>
          <p>Agrega adicionales para que los clientes puedan personalizar sus pedidos</p>
          <button class="btn-primary" (click)="openAddModal()">
            <i class="bi bi-plus-lg me-2"></i>
            Agregar Primer Adicional
          </button>
        </div>

        <div *ngIf="filteredAdds.length === 0 && adds.length > 0" class="empty-state">
          <i class="bi bi-search empty-icon"></i>
          <h3>No se encontraron adicionales</h3>
          <p>Intenta con otro t√©rmino de b√∫squeda</p>
        </div>
      </div>

      <!-- Modal para Crear/Editar Adicional -->
      <div *ngIf="showAddModal" class="modal-overlay" (click)="closeAddModal()">
        <div class="modal-content modal-large" (click)="$event.stopPropagation()">
          <div class="modal-header">
            <h3 class="modal-title">
              {{ selectedAdd ? 'Editar Adicional' : 'Nuevo Adicional' }}
            </h3>
            <button type="button" class="btn-close" (click)="closeAddModal()">
              <i class="bi bi-x-lg"></i>
            </button>
          </div>
          <div class="modal-body">
            <form [formGroup]="addForm" (ngSubmit)="saveAdd($event)">
              <div class="form-group">
                <label class="form-label">Nombre del Adicional *</label>
                <input
                  type="text"
                  class="form-control"
                  formControlName="name"
                  placeholder="Ej: Queso extra">
                <div *ngIf="addForm.get('name')?.invalid && addForm.get('name')?.touched" class="text-danger">
                  El nombre es requerido (m√≠nimo 2 caracteres)
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">Precio (COP) *</label>
                <input
                  type="number"
                  class="form-control"
                  formControlName="price"
                  min="0"
                  step="100"
                  placeholder="0">
                <div *ngIf="addForm.get('price')?.invalid && addForm.get('price')?.touched" class="text-danger">
                  El precio es requerido y debe ser mayor a 0
                </div>
              </div>

              <!-- Selector de modo: Categor√≠as o Productos Espec√≠ficos -->
              <div class="form-group">
                <label class="form-label">Disponibilidad del Adicional *</label>
                <div class="selection-mode-tabs mb-3">
                  <button
                    type="button"
                    class="btn-mode-tab"
                    [class.active]="addSelectionMode === 'categories'"
                    (click)="addSelectionMode = 'categories'; addForm.patchValue({ dishIds: [] }); selectedProductsForAdd = []">
                    Por Categor√≠as
                  </button>
                  <button
                    type="button"
                    class="btn-mode-tab"
                    [class.active]="addSelectionMode === 'products'"
                    (click)="addSelectionMode = 'products'; addForm.patchValue({ categoryIds: [] })">
                    Por Productos Espec√≠ficos
                  </button>
                  <button
                    type="button"
                    class="btn-mode-tab"
                    [class.active]="addSelectionMode === 'both'"
                    (click)="addSelectionMode = 'both'">
                    Ambos
                  </button>
                </div>
              </div>

              <!-- Selecci√≥n por Categor√≠as -->
              <div class="form-group" *ngIf="addSelectionMode === 'categories' || addSelectionMode === 'both'">
                <label class="form-label">
                  Categor√≠as
                  <span *ngIf="addSelectionMode === 'categories'" class="text-danger">*</span>
                </label>
                <div class="category-selection-info mb-2">
                  <small class="text-muted">
                    Selecciona las categor√≠as donde este adicional estar√° disponible.
                    Para que est√© disponible en todos los productos, selecciona todas las categor√≠as.
                  </small>
                </div>
                <div class="category-selection-actions mb-2">
                  <button type="button" class="btn-sm btn-outline-primary" (click)="selectAllCategories()">
                    Seleccionar Todas
                  </button>
                  <button type="button" class="btn-sm btn-outline-secondary" (click)="deselectAllCategories()">
                    Deseleccionar Todas
                  </button>
                </div>
                <div class="categories-checkbox-grid">
                  <label *ngFor="let category of categories" class="category-checkbox-item">
                    <input
                      type="checkbox"
                      [checked]="isCategorySelected(category.id)"
                      (change)="toggleCategorySelection(category.id)">
                    <span>{{ category.name }}</span>
                  </label>
                </div>
                <div *ngIf="categories.length === 0" class="alert alert-warning">
                  No hay categor√≠as disponibles. Crea categor√≠as primero.
                </div>
              </div>

              <!-- Selecci√≥n por Productos Espec√≠ficos -->
              <div class="form-group" *ngIf="addSelectionMode === 'products' || addSelectionMode === 'both'">
                <label class="form-label">
                  Productos Espec√≠ficos
                  <span *ngIf="addSelectionMode === 'products'" class="text-danger">*</span>
                </label>
                <div class="category-selection-info mb-2">
                  <small class="text-muted">
                    Selecciona los productos espec√≠ficos donde este adicional estar√° disponible.
                  </small>
                </div>
                <div class="category-selection-actions mb-2">
                  <button type="button" class="btn-sm btn-outline-primary" (click)="selectAllProducts()">
                    Seleccionar Todos
                  </button>
                  <button type="button" class="btn-sm btn-outline-secondary" (click)="deselectAllProducts()">
                    Deseleccionar Todos
                  </button>
                </div>
                <div class="categories-checkbox-grid">
                  <label *ngFor="let product of products" class="category-checkbox-item">
                    <input
                      type="checkbox"
                      [checked]="isProductSelected(product.id)"
                      (change)="toggleProductSelection(product.id)">
                    <span>{{ product.name }}</span>
                  </label>
                </div>
                <div *ngIf="products.length === 0" class="alert alert-warning">
                  No hay productos disponibles. Crea productos primero.
                </div>
              </div>

              <div class="form-group">
                <label class="form-check-label">
                  <input
                    type="checkbox"
                    class="form-check-input"
                    formControlName="available">
                  Disponible para los clientes
                </label>
              </div>

              <div class="modal-footer">
                <button type="button" class="btn-outline" (click)="closeAddModal(); $event.stopPropagation()">
                  Cancelar
                </button>
                <button type="submit" class="btn-primary" [disabled]="addForm.invalid" (click)="saveAdd($event)">
                  {{ selectedAdd ? 'Actualizar' : 'Crear' }}
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Tab: Mensajes de Contacto -->
      <div *ngIf="activeTab === 'messages'" class="tab-content">
        <div class="section-header">
          <h2 class="section-title">
            <i class="bi bi-envelope me-2"></i>
            Mensajes de Contacto
          </h2>
        </div>

        <!-- Filtros -->
        <div class="filters-section">
          <div class="filters-top-row">
            <div class="filter-tabs">
              <button class="filter-tab" [class.active]="messageFilter === 'all'" (click)="messageFilter = 'all'">
                Todos ({{ contactMessages.length }})
              </button>
              <button class="filter-tab" [class.active]="messageFilter === 'unread'" (click)="messageFilter = 'unread'">
                No Le√≠dos ({{ unreadMessagesCount }})
              </button>
              <button class="filter-tab" [class.active]="messageFilter === 'read'" (click)="messageFilter = 'read'">
                Le√≠dos ({{ contactMessages.length - unreadMessagesCount }})
              </button>
            </div>
          </div>
        </div>

        <!-- Lista de Mensajes -->
        <div class="messages-container-admin">
          <div *ngFor="let message of getFilteredMessages()" class="message-card-admin" [class.unread]="!message.read">
            <div class="message-header-admin">
              <div class="message-info-admin">
                <div class="message-subject-row">
                  <span class="message-subject" [class.unread]="!message.read">
                    <i class="bi bi-envelope-fill me-1" *ngIf="!message.read"></i>
                    <i class="bi bi-envelope-open me-1" *ngIf="message.read"></i>
                    {{ message.subject }}
                  </span>
                  <span class="message-date" *ngIf="message.createdAt">
                    <i class="bi bi-calendar3 me-1"></i>
                    {{ formatDate(message.createdAt) }}
                  </span>
                </div>
                <div class="message-sender-info">
                  <i class="bi bi-person me-1"></i>
                  <span class="sender-name">{{ message.name }}</span>
                  <span class="sender-email"> ‚Ä¢ {{ message.email }}</span>
                  <span class="sender-phone"> ‚Ä¢ {{ message.phone }}</span>
                </div>
                <div class="message-preview">
                  {{ message.message.length > 150 ? (message.message.substring(0, 150) + '...') : message.message }}
                </div>
              </div>
              <span class="status-badge" [ngClass]="message.read ? 'status-read' : 'status-unread'">
                {{ message.read ? 'Le√≠do' : 'No Le√≠do' }}
              </span>
            </div>

            <div class="message-actions-admin">
              <button
                class="btn-info"
                (click)="openMessageModal(message)"
                title="Ver mensaje completo">
                <i class="bi bi-eye me-1"></i>
                Ver Mensaje
              </button>
              <button
                class="btn-success"
                *ngIf="!message.read"
                (click)="markMessageAsRead(message)"
                title="Marcar como le√≠do">
                <i class="bi bi-check-circle me-1"></i>
                Marcar Le√≠do
              </button>
              <button
                class="btn-danger"
                (click)="deleteMessage(message)"
                title="Eliminar mensaje">
                <i class="bi bi-trash me-1"></i>
                Eliminar
              </button>
            </div>
          </div>
        </div>

        <div *ngIf="getFilteredMessages().length === 0" class="empty-state">
          <i class="bi bi-envelope-x empty-icon"></i>
          <h3>No hay mensajes</h3>
          <p *ngIf="messageFilter !== 'all'">No hay mensajes con el filtro seleccionado</p>
          <p *ngIf="messageFilter === 'all'">A√∫n no se han recibido mensajes de contacto</p>
        </div>
      </div>

      <!-- Modal de Mensaje -->
      <div *ngIf="showMessageModal && selectedMessage" class="modal-overlay" (click)="closeMessageModal()">
        <div class="modal-content modal-large" (click)="$event.stopPropagation()">
          <div class="modal-header">
            <h3 class="modal-title">
              <i class="bi bi-envelope me-2"></i>
              Mensaje de Contacto
            </h3>
            <button class="modal-close" (click)="closeMessageModal()">
              <i class="bi bi-x-lg"></i>
            </button>
          </div>
          <div class="modal-body">
            <div class="message-detail-section">
              <div class="detail-item">
                <label class="detail-label">Asunto:</label>
                <span class="detail-value">{{ selectedMessage.subject }}</span>
              </div>
              <div class="detail-item">
                <label class="detail-label">De:</label>
                <span class="detail-value">{{ selectedMessage.name }} ({{ selectedMessage.email }})</span>
              </div>
              <div class="detail-item">
                <label class="detail-label">Tel√©fono:</label>
                <span class="detail-value">{{ selectedMessage.phone }}</span>
              </div>
              <div class="detail-item" *ngIf="selectedMessage.createdAt">
                <label class="detail-label">Fecha:</label>
                <span class="detail-value">{{ formatDate(selectedMessage.createdAt) }}</span>
              </div>
              <div class="detail-item">
                <label class="detail-label">Mensaje:</label>
                <div class="message-content">
                  {{ selectedMessage.message }}
                </div>
              </div>
            </div>
          </div>
          <div class="modal-actions">
            <button type="button" class="btn-outline" (click)="closeMessageModal()">Cerrar</button>
            <button
              type="button"
              class="btn-danger"
              (click)="deleteMessage(selectedMessage); closeMessageModal()">
              <i class="bi bi-trash me-2"></i>
              Eliminar
            </button>
          </div>
        </div>
      </div>

      <!-- Tab: Clientes -->
      <div *ngIf="activeTab === 'customers'" class="tab-content">
        <div class="section-header">
          <h2 class="section-title">
            <i class="bi bi-people me-2"></i>
            Gesti√≥n de Clientes
          </h2>
          <div class="header-actions">
            <div class="view-toggle">
              <button
                class="view-toggle-btn"
                [class.active]="customerViewMode === 'list'"
                (click)="customerViewMode = 'list'"
                title="Vista de lista">
                <i class="bi bi-list-ul"></i>
              </button>
              <button
                class="view-toggle-btn"
                [class.active]="customerViewMode === 'grid'"
                (click)="customerViewMode = 'grid'"
                title="Vista de cuadr√≠cula">
                <i class="bi bi-grid-3x3-gap"></i>
              </button>
            </div>
          </div>
        </div>

        <!-- Filtros y B√∫squeda -->
        <div class="customer-filter-section">
          <div class="customer-filter-tabs">
            <button class="customer-filter-tab" [class.active]="customerFilter === 'all'" (click)="customerFilter = 'all'">
              Todos ({{ customers.length }})
            </button>
            <button class="customer-filter-tab" [class.active]="customerFilter === 'active'" (click)="customerFilter = 'active'">
              Activos
            </button>
            <button class="customer-filter-tab" [class.active]="customerFilter === 'inactive'" (click)="customerFilter = 'inactive'">
              Inactivos
            </button>
          </div>
          <div class="customer-search-section">
            <input
              type="text"
              class="customer-search-input"
              placeholder="Buscar clientes por nombre, email o tel√©fono..."
              [(ngModel)]="customerSearchTerm" />
            <button class="btn-primary" (click)="openAdminModal()" style="margin-left: 1rem;">
              <i class="bi bi-person-plus me-2"></i>
              Crear Admin
            </button>
          </div>
        </div>

        <!-- Vista de Lista -->
        <div *ngIf="customerViewMode === 'list'" class="customers-container-admin">
          <div *ngFor="let customer of getFilteredCustomers()" class="customer-card-admin" [class.active]="customer.status === 'active'">
            <div class="customer-header-admin">
              <div class="customer-info-admin">
                <div class="customer-avatar">
                  {{ getCustomerInitials(customer.name) }}
                </div>
                <div>
                  <div class="customer-id-row-admin">
                    <span class="customer-name-admin">{{ customer.name }}</span>
                    <span class="customer-role-badge" [ngClass]="customer.role">{{ customer.role }}</span>
                    <span class="customer-status-badge" [ngClass]="customer.status">{{ customer.status === 'active' ? 'Activo' : 'Inactivo' }}</span>
                  </div>
                  <div class="customer-email-admin" *ngIf="customer.email">
                    <i class="bi bi-envelope"></i>
                    {{ customer.email }}
                  </div>
                  <div class="customer-phone-admin" *ngIf="customer.phone">
                    <i class="bi bi-telephone"></i>
                    {{ customer.phone }}
                  </div>
                  <div class="customer-address-info" *ngIf="customer.address">
                    <i class="bi bi-geo-alt"></i>
                    <span>{{ customer.address }}</span>
                  </div>
                  <div class="customer-registered-date" *ngIf="customer.lastOrderDate">
                    <i class="bi bi-calendar3"></i>
                    √öltima actividad: {{ formatDate(customer.lastOrderDate) }}
                  </div>
                  <div class="customer-registered-date" *ngIf="!customer.lastOrderDate && customer.createdAt">
                    <i class="bi bi-calendar3"></i>
                    Registrado: {{ formatDate(customer.createdAt) }}
                  </div>
                  <div class="customer-registered-date" *ngIf="!customer.lastOrderDate && !customer.createdAt">
                    <i class="bi bi-calendar3"></i>
                    Sin actividad registrada
                  </div>
                </div>
              </div>
            </div>

            <div class="customer-stats">
              <div class="customer-stat-item">
                <span class="customer-stat-value">{{ customer.totalOrders || 0 }}</span>
                <span class="customer-stat-label">Pedidos</span>
              </div>
              <div class="customer-stat-item">
                <span class="customer-stat-value">{{ customer.totalReservations || 0 }}</span>
                <span class="customer-stat-label">Reservas</span>
              </div>
              <div class="customer-stat-item">
                <span class="customer-stat-value">${{ (customer.totalSpent || 0) | number:'1.0-0' }}</span>
                <span class="customer-stat-label">Total Gastado</span>
              </div>
            </div>

            <div class="customer-actions-admin">
              <button class="btn-primary" (click)="openCustomerModal(customer)">
                <i class="bi bi-eye me-1"></i>
                Ver Detalles
              </button>
              <button class="btn-icon-small" (click)="openCustomerModal(customer, true)" title="Editar">
                <i class="bi bi-pencil"></i>
              </button>
              <button class="btn-icon-small btn-danger" (click)="deleteCustomer(customer)" title="Eliminar">
                <i class="bi bi-trash"></i>
              </button>
            </div>
          </div>
        </div>

        <!-- Vista de Grid -->
        <div *ngIf="customerViewMode === 'grid'" class="customers-grid-view">
          <div *ngFor="let customer of getFilteredCustomers()" class="customer-card-compact" [class.active]="customer.status === 'active'">
            <div class="customer-card-compact-header">
              <div class="customer-avatar">
                {{ getCustomerInitials(customer.name) }}
              </div>
              <div>
                <h3 class="customer-name-admin">{{ customer.name }}</h3>
                <span class="customer-status-badge" [ngClass]="customer.status">{{ customer.status === 'active' ? 'Activo' : 'Inactivo' }}</span>
              </div>
            </div>
            <div class="customer-card-compact-body">
              <div class="customer-email-admin" *ngIf="customer.email">
                <i class="bi bi-envelope"></i>
                {{ customer.email }}
              </div>
              <div class="customer-phone-admin" *ngIf="customer.phone">
                <i class="bi bi-telephone"></i>
                {{ customer.phone }}
              </div>
              <div class="customer-stats" style="margin: 0.5rem 0;">
                <div class="customer-stat-item">
                  <span class="customer-stat-value" style="font-size: 1.25rem;">{{ customer.totalOrders || 0 }}</span>
                  <span class="customer-stat-label">Pedidos</span>
                </div>
                <div class="customer-stat-item">
                  <span class="customer-stat-value" style="font-size: 1.25rem;">${{ (customer.totalSpent || 0) | number:'1.0-0' }}</span>
                  <span class="customer-stat-label">Gastado</span>
                </div>
              </div>
            </div>
            <div class="customer-card-compact-footer">
              <button class="btn-primary" (click)="openCustomerModal(customer)">
                <i class="bi bi-eye"></i>
              </button>
            </div>
          </div>
        </div>

        <div *ngIf="getFilteredCustomers().length === 0" class="empty-state">
          <i class="bi bi-people empty-icon"></i>
          <h3>No se encontraron clientes</h3>
          <p *ngIf="customerFilter !== 'all' || customerSearchTerm">No hay clientes que coincidan con los filtros seleccionados</p>
          <p *ngIf="customerFilter === 'all' && !customerSearchTerm">A√∫n no hay clientes registrados</p>
        </div>
      </div>

      <!-- Modal de Detalles de Cliente -->
      <div *ngIf="showCustomerModal && selectedCustomer" class="modal-overlay" (click)="closeCustomerModal()">
        <div class="modal-content customer-details-modal" (click)="$event.stopPropagation()">
          <div class="modal-header">
            <h3 class="modal-title">Detalles del Cliente</h3>
            <button class="modal-close-btn" (click)="closeCustomerModal()">
              <i class="bi bi-x-lg"></i>
            </button>
          </div>
          <div class="modal-body">
            <div class="customer-details-header">
              <div class="customer-details-avatar">
                {{ getCustomerInitials(selectedCustomer.name) }}
              </div>
              <div class="customer-details-info">
                <h2 class="customer-details-name">{{ selectedCustomer.name }}</h2>
                <div class="customer-details-email" *ngIf="selectedCustomer.email">
                  <i class="bi bi-envelope me-1"></i>
                  {{ selectedCustomer.email }}
                </div>
                <div class="customer-details-phone" *ngIf="selectedCustomer.phone">
                  <i class="bi bi-telephone me-1"></i>
                  {{ selectedCustomer.phone }}
                </div>
                <div style="margin-top: 0.5rem;">
                  <span class="customer-role-badge" [ngClass]="selectedCustomer.role">{{ selectedCustomer.role }}</span>
                  <span class="customer-status-badge" [ngClass]="selectedCustomer.status" style="margin-left: 0.5rem;">
                    {{ selectedCustomer.status === 'active' ? 'Activo' : 'Inactivo' }}
                  </span>
                </div>
              </div>
            </div>

            <div class="customer-details-sections" *ngIf="!isEditingCustomer">
              <div class="customer-details-section">
                <h4 class="customer-details-section-title">
                  <i class="bi bi-info-circle"></i>
                  Informaci√≥n General
                </h4>
                <div class="customer-details-grid">
                  <div class="customer-detail-item">
                    <span class="customer-detail-label">Nombre</span>
                    <span class="customer-detail-value">{{ selectedCustomer.name }}</span>
                  </div>
                  <div class="customer-detail-item" *ngIf="selectedCustomer.email">
                    <span class="customer-detail-label">Email</span>
                    <span class="customer-detail-value">{{ selectedCustomer.email }}</span>
                  </div>
                  <div class="customer-detail-item" *ngIf="selectedCustomer.phone">
                    <span class="customer-detail-label">Tel√©fono</span>
                    <span class="customer-detail-value">{{ selectedCustomer.phone }}</span>
                  </div>
                  <div class="customer-detail-item" *ngIf="selectedCustomer.address">
                    <span class="customer-detail-label">Direcci√≥n</span>
                    <span class="customer-detail-value">{{ selectedCustomer.address }}</span>
                  </div>
                  <div class="customer-detail-item" *ngIf="selectedCustomer.lastOrderDate">
                    <span class="customer-detail-label">√öltima Actividad</span>
                    <span class="customer-detail-value">{{ formatDate(selectedCustomer.lastOrderDate) }}</span>
                  </div>
                  <div class="customer-detail-item" *ngIf="!selectedCustomer.lastOrderDate && selectedCustomer.createdAt">
                    <span class="customer-detail-label">Fecha de Registro</span>
                    <span class="customer-detail-value">{{ formatDate(selectedCustomer.createdAt) }}</span>
                  </div>
                  <div class="customer-detail-item" *ngIf="!selectedCustomer.lastOrderDate && !selectedCustomer.createdAt">
                    <span class="customer-detail-label">√öltima Actividad</span>
                    <span class="customer-detail-value">Sin actividad registrada</span>
                  </div>
                </div>
              </div>

              <div class="customer-details-section">
                <h4 class="customer-details-section-title">
                  <i class="bi bi-bar-chart"></i>
                  Estad√≠sticas
                </h4>
                <div class="customer-stats">
                  <div class="customer-stat-item">
                    <span class="customer-stat-value">{{ selectedCustomer.totalOrders || 0 }}</span>
                    <span class="customer-stat-label">Total Pedidos</span>
                  </div>
                  <div class="customer-stat-item">
                    <span class="customer-stat-value">{{ selectedCustomer.totalReservations || 0 }}</span>
                    <span class="customer-stat-label">Total Reservas</span>
                  </div>
                  <div class="customer-stat-item">
                    <span class="customer-stat-value">${{ (selectedCustomer.totalSpent || 0) | number:'1.0-0' }}</span>
                    <span class="customer-stat-label">Total Gastado</span>
                  </div>
                </div>
              </div>

              <div class="customer-orders-list" *ngIf="getCustomerOrders(selectedCustomer.id).length > 0">
                <h4 class="customer-orders-list-title">
                  <i class="bi bi-receipt-cutoff"></i>
                  Pedidos del Cliente
                </h4>
                <div *ngFor="let order of getCustomerOrders(selectedCustomer.id).slice(0, 5)" class="customer-order-item">
                  <div class="customer-order-info">
                    <span class="customer-order-id">Pedido #{{ order.id.slice(-8) }}</span>
                    <span class="customer-order-date">{{ formatDate(order.date) }}</span>
                  </div>
                  <span class="customer-order-total">${{ order.total | number }}</span>
                </div>
              </div>

              <div class="customer-reservations-list" *ngIf="getCustomerReservations(selectedCustomer.email, selectedCustomer.name).length > 0">
                <h4 class="customer-reservations-list-title">
                  <i class="bi bi-calendar-check"></i>
                  Reservas del Cliente
                </h4>
                <div *ngFor="let reservation of getCustomerReservations(selectedCustomer.email, selectedCustomer.name).slice(0, 5)" class="customer-reservation-item">
                  <div class="customer-reservation-info">
                    <span class="customer-reservation-table">Mesa {{ reservation.tableNumber }}</span>
                    <span class="customer-reservation-date">{{ reservation.date }} - {{ reservation.time }}</span>
                  </div>
                  <span class="status-badge" [ngClass]="getReservationStatusClass(reservation.status)">
                    {{ getReservationStatusText(reservation.status) }}
                  </span>
                </div>
              </div>
            </div>

            <!-- Formulario de Edici√≥n -->
            <div *ngIf="isEditingCustomer" class="customer-edit-form">
              <h4 class="customer-details-section-title">
                <i class="bi bi-pencil"></i>
                Editar Cliente
              </h4>
              <form [formGroup]="customerForm" (ngSubmit)="saveCustomer()">
                <div class="form-group">
                  <label class="form-label">Nombre *</label>
                  <input type="text" formControlName="name" class="form-control" />
                  <div *ngIf="customerForm.get('name')?.invalid && customerForm.get('name')?.touched" class="text-danger">
                    El nombre es requerido (m√≠nimo 2 caracteres)
                  </div>
                </div>

                <div class="form-group">
                  <label class="form-label">Email *</label>
                  <input type="email" formControlName="email" class="form-control" />
                  <div *ngIf="customerForm.get('email')?.invalid && customerForm.get('email')?.touched" class="text-danger">
                    El email es requerido y debe ser v√°lido
                  </div>
                </div>

                <div class="form-group">
                  <label class="form-label">Tel√©fono *</label>
                  <input type="text" formControlName="phone" class="form-control" />
                  <div *ngIf="customerForm.get('phone')?.invalid && customerForm.get('phone')?.touched" class="text-danger">
                    El tel√©fono es requerido
                  </div>
                </div>

                <div class="form-group">
                  <label class="form-label">Direcci√≥n</label>
                  <input type="text" formControlName="address" class="form-control" />
                </div>
              </form>
            </div>
          </div>
          <div class="modal-footer">
            <button *ngIf="!isEditingCustomer" class="btn-primary" (click)="openCustomerModal(selectedCustomer, true)">
              <i class="bi bi-pencil me-2"></i>
              Editar Cliente
            </button>
            <button *ngIf="!isEditingCustomer" class="btn-danger" (click)="deleteCustomer(selectedCustomer)">
              <i class="bi bi-trash me-2"></i>
              Eliminar Cliente
            </button>
            <button *ngIf="isEditingCustomer" type="button" class="btn-outline" (click)="closeCustomerModal()">Cancelar</button>
            <button *ngIf="isEditingCustomer" type="submit" class="btn-primary" [disabled]="customerForm.invalid" (click)="saveCustomer()">
              Guardar Cambios
            </button>
            <button *ngIf="!isEditingCustomer" class="btn-outline" (click)="closeCustomerModal()">Cerrar</button>
          </div>
        </div>
      </div>

      <!-- Modal para Crear Admin -->
      <div *ngIf="showAdminModal" class="modal-overlay" (click)="closeAdminModal()">
        <div class="modal-content" (click)="$event.stopPropagation()">
          <div class="modal-header">
            <h3>Crear Nuevo Administrador</h3>
            <button class="modal-close-btn" (click)="closeAdminModal()">
              <i class="bi bi-x-lg"></i>
            </button>
          </div>
          <div class="modal-body">
            <form [formGroup]="adminForm" (ngSubmit)="createAdmin()">
              <div class="form-group">
                <label class="form-label">Nombre Completo *</label>
                <input type="text" formControlName="name" class="form-control" />
                <div *ngIf="adminForm.get('name')?.invalid && adminForm.get('name')?.touched" class="text-danger">
                  El nombre es requerido (m√≠nimo 2 caracteres)
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">Email *</label>
                <input type="email" formControlName="email" class="form-control" />
                <div *ngIf="adminForm.get('email')?.invalid && adminForm.get('email')?.touched" class="text-danger">
                  El email es requerido y debe ser v√°lido
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">Tel√©fono *</label>
                <input type="text" formControlName="phone" class="form-control" placeholder="10 d√≠gitos" />
                <div *ngIf="adminForm.get('phone')?.invalid && adminForm.get('phone')?.touched" class="text-danger">
                  El tel√©fono es requerido (10 d√≠gitos)
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">Contrase√±a *</label>
                <input type="password" formControlName="password" class="form-control" />
                <div *ngIf="adminForm.get('password')?.invalid && adminForm.get('password')?.touched" class="text-danger">
                  La contrase√±a debe tener al menos 8 caracteres, incluir may√∫sculas, min√∫sculas y n√∫meros
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">Confirmar Contrase√±a *</label>
                <input type="password" formControlName="confirmPassword" class="form-control" />
                <div *ngIf="adminForm.get('confirmPassword')?.invalid && adminForm.get('confirmPassword')?.touched" class="text-danger">
                  Las contrase√±as deben coincidir
                </div>
                <div *ngIf="adminForm.hasError('passwordMismatch') && adminForm.get('confirmPassword')?.touched" class="text-danger">
                  Las contrase√±as no coinciden
                </div>
              </div>

              <div class="modal-footer">
                <button type="button" class="btn-outline" (click)="closeAdminModal()">Cancelar</button>
                <button type="submit" class="btn-primary" [disabled]="adminForm.invalid">
                  Crear Administrador
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Tab: Configuraci√≥n -->
      <div *ngIf="activeTab === 'settings'" class="tab-content">
        <h2 class="section-title">Configuraci√≥n</h2>

        <form [formGroup]="settingsForm" (ngSubmit)="onSettingsSubmit()" class="settings-form">
          <!-- Informaci√≥n General -->
          <div class="settings-section">
            <h3 class="settings-section-title">
              <i class="bi bi-info-circle"></i>
              Informaci√≥n General
            </h3>
            <div class="settings-grid">
              <div class="form-group">
                <label class="form-label">Nombre del Restaurante</label>
                <input type="text" formControlName="restaurantName" class="form-control" />
              </div>
              <div class="form-group">
                <label class="form-label">Email de Contacto</label>
                <input type="email" formControlName="email" class="form-control" />
              </div>
              <div class="form-group">
                <label class="form-label">Tel√©fono</label>
                <input type="tel" formControlName="phone" class="form-control" />
              </div>
              <div class="form-group">
                <label class="form-label">Direcci√≥n</label>
                <input type="text" formControlName="address" class="form-control" />
              </div>
            </div>
          </div>

          <!-- Horarios -->
          <div class="settings-section">
            <h3 class="settings-section-title">
              <i class="bi bi-clock"></i>
              Horarios de Atenci√≥n
            </h3>
            <div class="settings-grid">
              <div class="form-group">
                <label class="form-label">Hora de Apertura</label>
                <input type="time" formControlName="openingTime" class="form-control" />
              </div>
              <div class="form-group">
                <label class="form-label">Hora de Cierre</label>
                <input type="time" formControlName="closingTime" class="form-control" />
              </div>
            </div>
          </div>

          <!-- Opciones de Servicio -->
          <div class="settings-section">
            <h3 class="settings-section-title">
              <i class="bi bi-truck"></i>
              Opciones de Servicio
            </h3>
            <div class="settings-grid">
              <div class="form-group">
                <label class="checkbox-label">
                  <input type="checkbox" formControlName="deliveryEnabled" />
                  <span>Habilitar Delivery</span>
                </label>
              </div>
              <div class="form-group">
                <label class="checkbox-label">
                  <input type="checkbox" formControlName="pickupEnabled" />
                  <span>Habilitar Recoger en Tienda</span>
                </label>
              </div>
            </div>
          </div>

          <!-- Configuraci√≥n de Pedidos -->
          <div class="settings-section">
            <h3 class="settings-section-title">
              <i class="bi bi-gear"></i>
              Configuraci√≥n de Pedidos
            </h3>
            <div class="settings-grid">
              <div class="form-group">
                <label class="form-label">Tasa de Impuesto (%)</label>
                <input type="number" formControlName="taxRate" class="form-control" min="0" max="100" />
              </div>
              <div class="form-group">
                <label class="form-label">Monto M√≠nimo de Pedido</label>
                <input type="number" formControlName="minOrderAmount" class="form-control" min="0" />
              </div>
              <div class="form-group">
                <label class="form-label">Costo de Delivery</label>
                <input type="number" formControlName="deliveryFee" class="form-control" min="0" />
              </div>
              <div class="form-group">
                <label class="form-label">Distancia M√°xima de Delivery (km)</label>
                <input type="number" formControlName="maxDeliveryDistance" class="form-control" min="1" />
              </div>
            </div>
          </div>

          <div class="settings-form-footer">
            <button type="submit" class="btn-primary" [disabled]="settingsForm.invalid">
              <i class="bi bi-save me-2"></i>
              Guardar Configuraci√≥n
            </button>
          </div>
        </form>
      </div>

      <!-- Modal de Producto -->
      <div *ngIf="showProductModal" class="modal-overlay" (click)="closeProductModal()">
        <div class="modal-content" (click)="$event.stopPropagation()">
          <div class="modal-header">
            <h3>{{ isViewingProduct ? 'Ver Producto' : (selectedProduct ? 'Editar Producto' : 'Nuevo Producto') }}</h3>
            <button class="modal-close-btn" (click)="closeProductModal()">
              <i class="bi bi-x-lg"></i>
            </button>
          </div>
          <div class="modal-body">
            <form [formGroup]="productForm" (ngSubmit)="saveProduct()">
              <div class="form-group">
                <label class="form-label">Nombre *</label>
                <input type="text" formControlName="name" class="form-control" />
                <div *ngIf="productForm.get('name')?.invalid && productForm.get('name')?.touched" class="text-danger">
                  El nombre es requerido (m√≠nimo 3 caracteres)
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">Descripci√≥n *</label>
                <textarea formControlName="description" class="form-control" rows="3"></textarea>
                <div *ngIf="productForm.get('description')?.invalid && productForm.get('description')?.touched" class="text-danger">
                  La descripci√≥n es requerida (m√≠nimo 10 caracteres)
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">Precio *</label>
                <input type="number" formControlName="price" class="form-control" min="1" step="100" />
                <div *ngIf="productForm.get('price')?.invalid && productForm.get('price')?.touched" class="text-danger">
                  El precio es requerido y debe ser mayor a 0
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">Categor√≠a *</label>
                <select formControlName="categoryId" class="form-control">
                  <option value="">Selecciona una categor√≠a</option>
                  <option *ngFor="let cat of categories" [value]="cat.id">{{ cat.name }}</option>
                </select>
                <div *ngIf="productForm.get('categoryId')?.invalid && productForm.get('categoryId')?.touched" class="text-danger">
                  La categor√≠a es requerida
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">URL de Imagen</label>
                <input type="text" formControlName="imageUrl" class="form-control" placeholder="https://..." />
              </div>

              <div class="form-group">
                <label class="form-check-label">
                  <input type="checkbox" formControlName="available" class="form-check-input" />
                  Disponible
                </label>
              </div>

              <div class="modal-footer">
                <button *ngIf="!isViewingProduct" type="button" class="btn-outline" (click)="closeProductModal()">Cancelar</button>
                <button *ngIf="isViewingProduct" type="button" class="btn-primary" (click)="openProductModal(selectedProduct || undefined)">
                  <i class="bi bi-pencil me-2"></i>
                  Editar
                </button>
                <button *ngIf="!isViewingProduct" type="submit" class="btn-primary" [disabled]="productForm.invalid">
                  {{ selectedProduct ? 'Actualizar' : 'Crear' }}
                </button>
                <button *ngIf="isViewingProduct" type="button" class="btn-outline" (click)="closeProductModal()">Cerrar</button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Modal de Categor√≠a -->
      <div *ngIf="showCategoryModal" class="modal-overlay" (click)="closeCategoryModal()">
        <div class="modal-content" (click)="$event.stopPropagation()">
          <div class="modal-header">
            <h3>{{ selectedCategory ? 'Editar Categor√≠a' : 'Nueva Categor√≠a' }}</h3>
            <button class="modal-close-btn" (click)="closeCategoryModal()">
              <i class="bi bi-x-lg"></i>
            </button>
          </div>
          <div class="modal-body">
            <form [formGroup]="categoryForm" (ngSubmit)="saveCategory()">
              <div class="form-group">
                <label class="form-label">Nombre *</label>
                <input type="text" formControlName="name" class="form-control" />
                <div *ngIf="categoryForm.get('name')?.invalid && categoryForm.get('name')?.touched" class="text-danger">
                  El nombre es requerido (m√≠nimo 2 caracteres)
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">Descripci√≥n *</label>
                <textarea formControlName="description" class="form-control" rows="3"></textarea>
                <div *ngIf="categoryForm.get('description')?.invalid && categoryForm.get('description')?.touched" class="text-danger">
                  La descripci√≥n es requerida (m√≠nimo 5 caracteres)
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">URL de Imagen</label>
                <input type="text" formControlName="imageUrl" class="form-control" placeholder="https://..." />
              </div>

              <div class="modal-footer">
                <button type="button" class="btn-outline" (click)="closeCategoryModal()">Cancelar</button>
                <button type="submit" class="btn-primary" [disabled]="categoryForm.invalid">
                  {{ selectedCategory ? 'Actualizar' : 'Crear' }}
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Modal de Inventario/Insumo -->
      <div *ngIf="showSupplyModal" class="modal-overlay" (click)="closeSupplyModal()">
        <div class="modal-content" (click)="$event.stopPropagation()">
          <div class="modal-header">
            <h3>{{ selectedSupply ? 'Editar Insumo' : 'Nuevo Insumo' }}</h3>
            <button class="modal-close-btn" (click)="closeSupplyModal()">
              <i class="bi bi-x-lg"></i>
            </button>
          </div>
          <div class="modal-body">
            <form [formGroup]="supplyForm" (ngSubmit)="saveSupply()">
              <div class="form-group">
                <label class="form-label">Nombre *</label>
                <input type="text" formControlName="name" class="form-control" />
                <div *ngIf="supplyForm.get('name')?.invalid && supplyForm.get('name')?.touched" class="text-danger">
                  El nombre es requerido (m√≠nimo 3 caracteres)
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">Descripci√≥n *</label>
                <textarea formControlName="description" class="form-control" rows="3"></textarea>
                <div *ngIf="supplyForm.get('description')?.invalid && supplyForm.get('description')?.touched" class="text-danger">
                  La descripci√≥n es requerida (m√≠nimo 10 caracteres)
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">Precio Unitario *</label>
                <input type="number" formControlName="unit_price" class="form-control" min="0" step="100" />
                <div *ngIf="supplyForm.get('unit_price')?.invalid && supplyForm.get('unit_price')?.touched" class="text-danger">
                  El precio unitario es requerido y debe ser mayor o igual a 0
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">Cantidad *</label>
                <input type="number" formControlName="quantity" class="form-control" min="0" />
                <div *ngIf="supplyForm.get('quantity')?.invalid && supplyForm.get('quantity')?.touched" class="text-danger">
                  La cantidad es requerida y debe ser mayor o igual a 0
                </div>
              </div>

              <div class="modal-footer">
                <button type="button" class="btn-outline" (click)="closeSupplyModal()">Cancelar</button>
                <button type="submit" class="btn-primary" [disabled]="supplyForm.invalid">
                  {{ selectedSupply ? 'Actualizar' : 'Crear' }}
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
  </div>
</section>
