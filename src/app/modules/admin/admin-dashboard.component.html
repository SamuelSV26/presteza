<section class="admin-dashboard">
  <div class="admin-container-wrapper">
    <div class="container-fluid admin-container">
    <!-- Sidebar de Navegaci√≥n -->
    <div class="admin-sidebar">
      <nav class="admin-nav">
        <button
          class="nav-item"
          [class.active]="activeTab === 'dashboard'"
          (click)="setActiveTab('dashboard')">
          <i class="bi bi-speedometer2"></i>
          <span>Dashboard</span>
        </button>
        <button
          class="nav-item"
          [class.active]="activeTab === 'products'"
          (click)="setActiveTab('products')">
          <i class="bi bi-box-seam"></i>
          <span>Productos</span>
          <span class="badge">{{ stats.totalProducts }}</span>
        </button>
        <button
          class="nav-item"
          [class.active]="activeTab === 'orders'"
          (click)="setActiveTab('orders')">
          <i class="bi bi-receipt-cutoff"></i>
          <span>Pedidos</span>
          <span class="badge badge-warning" *ngIf="stats.pendingOrders > 0">{{ stats.pendingOrders }}</span>
        </button>
        <button
          class="nav-item"
          [class.active]="activeTab === 'categories'"
          (click)="setActiveTab('categories')">
          <i class="bi bi-folder"></i>
          <span>Categor√≠as</span>
        </button>
        <button
          class="nav-item"
          [class.active]="activeTab === 'inventory'"
          (click)="setActiveTab('inventory')">
          <i class="bi bi-boxes"></i>
          <span>Inventario</span>
        </button>
        <button
          class="nav-item"
          [class.active]="activeTab === 'reservations'"
          (click)="setActiveTab('reservations')">
          <i class="bi bi-calendar-check"></i>
          <span>Reservas</span>
          <span class="badge badge-warning" *ngIf="stats.pendingReservations > 0">{{ stats.pendingReservations }}</span>
        </button>
        <button
          class="nav-item"
          [class.active]="activeTab === 'settings'"
          (click)="setActiveTab('settings')">
          <i class="bi bi-gear"></i>
          <span>Configuraci√≥n</span>
        </button>
      </nav>
      <div class="sidebar-footer">
        <button class="nav-item nav-item-logout" (click)="logout()">
          <i class="bi bi-box-arrow-right"></i>
          <span>Salir</span>
        </button>
      </div>
    </div>

    <!-- Contenido Principal -->
    <div class="admin-content">
      <!-- Mensaje de Bienvenida -->
      <div class="welcome-section">
        <h1 class="welcome-title">
          <i class="bi bi-hand-thumbs-up"></i>
          Bienvenido, Administrador
        </h1>
        <p class="welcome-subtitle">Gestiona tu restaurante desde aqu√≠</p>
      </div>

      <!-- Tab: Dashboard -->
      <div *ngIf="activeTab === 'dashboard'" class="tab-content">
        <h2 class="section-title">Resumen General</h2>

        <!-- Tarjetas de Estad√≠sticas -->
        <div class="stats-grid">
          <div class="stat-card stat-primary">
            <div class="stat-icon">
              <i class="bi bi-receipt-cutoff"></i>
            </div>
            <div class="stat-info">
              <h3 class="stat-value">{{ stats.totalOrders }}</h3>
              <p class="stat-label">Total Pedidos</p>
            </div>
          </div>

          <div class="stat-card stat-warning">
            <div class="stat-icon">
              <i class="bi bi-hourglass-split"></i>
            </div>
            <div class="stat-info">
              <h3 class="stat-value">{{ stats.pendingOrders }}</h3>
              <p class="stat-label">Pedidos Pendientes</p>
            </div>
          </div>

          <div class="stat-card stat-success">
            <div class="stat-icon">
              <i class="bi bi-currency-dollar"></i>
            </div>
            <div class="stat-info">
              <h3 class="stat-value">${{ stats.totalRevenue | number:'1.0-0' }}</h3>
              <p class="stat-label">Ingresos Totales</p>
            </div>
          </div>

          <div class="stat-card stat-info">
            <div class="stat-icon">
              <i class="bi bi-box-seam"></i>
            </div>
            <div class="stat-info">
              <h3 class="stat-value">{{ stats.totalProducts }}</h3>
              <p class="stat-label">Productos Activos</p>
            </div>
          </div>

          <div class="stat-card stat-warning">
            <div class="stat-icon">
              <i class="bi bi-calendar-check"></i>
            </div>
            <div class="stat-info">
              <h3 class="stat-value">{{ stats.totalReservations }}</h3>
              <p class="stat-label">Total Reservas</p>
            </div>
          </div>

          <div class="stat-card stat-info">
            <div class="stat-icon">
              <i class="bi bi-hourglass-split"></i>
            </div>
            <div class="stat-info">
              <h3 class="stat-value">{{ stats.pendingReservations }}</h3>
              <p class="stat-label">Reservas Pendientes</p>
            </div>
          </div>
        </div>

        <!-- Pedidos Recientes -->
        <div class="recent-orders-card">
          <div class="card-header">
            <h3 class="card-title">Pedidos Recientes</h3>
            <button class="btn-link" (click)="setActiveTab('orders')">Ver Todos</button>
          </div>
          <div class="orders-table">
            <table>
              <thead>
                <tr>
                  <th>ID Pedido</th>
                  <th>Fecha</th>
                  <th>Cliente</th>
                  <th>Total</th>
                  <th>Estado</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let order of orders.slice(0, 5)">
                  <td>{{ order.id.slice(-8) }}</td>
                  <td>{{ formatDate(order.date) }}</td>
                  <td>{{ order.deliveryPhone || order.deliveryAddress || 'N/A' }}</td>
                  <td>${{ order.total | number }}</td>
                  <td>
                    <span class="status-badge" [ngClass]="getOrderStatusClass(order.status)">
                      {{ getOrderStatusText(order.status) }}
                    </span>
                  </td>
                  <td>
                    <button class="btn-icon-small" (click)="selectedOrder = order; setActiveTab('orders')">
                      <i class="bi bi-eye"></i>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Tab: Productos -->
      <div *ngIf="activeTab === 'products'" class="tab-content">
        <div class="section-header">
          <h2 class="section-title">Gesti√≥n de Productos</h2>
          <div class="header-actions">
            <div class="view-toggle">
              <button
                class="view-toggle-btn"
                [class.active]="productViewMode === 'list'"
                (click)="productViewMode = 'list'"
                title="Vista de lista">
                <i class="bi bi-list-ul"></i>
              </button>
              <button
                class="view-toggle-btn"
                [class.active]="productViewMode === 'grid'"
                (click)="productViewMode = 'grid'"
                title="Vista de cuadr√≠cula">
                <i class="bi bi-grid-3x3-gap"></i>
              </button>
            </div>
            <button class="btn-primary" (click)="openProductModal()">
              <i class="bi bi-plus-lg"></i>
              Agregar Producto
            </button>
          </div>
        </div>

        <!-- Filtros y B√∫squeda -->
        <div class="filters-section">
          <input
            type="text"
            class="search-input"
            placeholder="Buscar productos..."
            [(ngModel)]="searchTerm" />
          <select class="filter-select" [(ngModel)]="categoryFilter">
            <option value="">Todas las categor√≠as</option>
            <option *ngFor="let cat of categories" [value]="cat.id">{{ cat.name }}</option>
          </select>
        </div>

        <!-- Vista de Lista -->
        <div *ngIf="productViewMode === 'list'" class="products-table-card">
          <table class="admin-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Categor√≠a</th>
                <th>Precio</th>
                <th>Estado</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let product of getFilteredProducts()">
                <td>{{ product.id }}</td>
                <td>{{ product.name }}</td>
                <td>{{ product.categoryId }}</td>
                <td>${{ product.price | number }}</td>
                <td>
                  <span class="status-badge" [class.status-success]="product.available" [class.status-danger]="!product.available">
                    {{ product.available ? 'Disponible' : 'No Disponible' }}
                  </span>
                </td>
                <td>
                  <div class="action-buttons">
                    <button class="btn-icon-small" (click)="openProductModal(product)" title="Editar">
                      <i class="bi bi-pencil"></i>
                    </button>
                    <button class="btn-icon-small" (click)="toggleProductAvailability(product)"
                            [title]="product.available ? 'Desactivar' : 'Activar'">
                      <i class="bi" [class.bi-toggle-on]="product.available" [class.bi-toggle-off]="!product.available"></i>
                    </button>
                    <button class="btn-icon-small btn-danger" (click)="deleteProduct(product.id)" title="Eliminar">
                      <i class="bi bi-trash"></i>
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Vista de Grid -->
        <div *ngIf="productViewMode === 'grid'" class="products-grid-view">
          <div class="products-grid">
            <div *ngFor="let product of getFilteredProducts()" class="product-card-grid">
              <div class="product-card-image">
                <img [src]="product.imageUrl || 'https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=600&q=80'"
                     [alt]="product.name"
                     class="product-image" />
                <div class="product-card-overlay">
                  <span class="status-badge" [class.status-success]="product.available" [class.status-danger]="!product.available">
                    {{ product.available ? 'Disponible' : 'No Disponible' }}
                  </span>
                </div>
              </div>
              <div class="product-card-body">
                <div class="product-card-header">
                  <span class="product-id">#{{ product.id }}</span>
                  <span class="product-price">${{ product.price | number }}</span>
                </div>
                <h3 class="product-name">{{ product.name }}</h3>
                <p class="product-description">{{ product.description }}</p>
                <div class="product-category">
                  <i class="bi bi-folder"></i>
                  <span>{{ product.categoryId }}</span>
                </div>
                <div class="product-card-actions">
                  <button class="btn-icon-small" (click)="openProductModal(product)" title="Editar">
                    <i class="bi bi-pencil"></i>
                  </button>
                  <button class="btn-icon-small" (click)="toggleProductAvailability(product)"
                          [title]="product.available ? 'Desactivar' : 'Activar'">
                    <i class="bi" [class.bi-toggle-on]="product.available" [class.bi-toggle-off]="!product.available"></i>
                  </button>
                  <button class="btn-icon-small btn-danger" (click)="deleteProduct(product.id)" title="Eliminar">
                    <i class="bi bi-trash"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Tab: Pedidos -->
      <div *ngIf="activeTab === 'orders'" class="tab-content">
        <div class="section-header">
          <h2 class="section-title">Gesti√≥n de Pedidos</h2>
        </div>

        <!-- Filtros y Controles -->
        <div class="filters-section">
          <div class="filters-top-row">
            <div class="filter-tabs">
              <button class="filter-tab" [class.active]="orderFilter === 'all'" (click)="orderFilter = 'all'">
                Todos ({{ orders.length }})
              </button>
              <button class="filter-tab" [class.active]="orderFilter === 'pending'" (click)="orderFilter = 'pending'">
                Pendientes ({{ pendingOrdersCount }})
              </button>
              <button class="filter-tab" [class.active]="orderFilter === 'preparing'" (click)="orderFilter = 'preparing'">
                En Preparaci√≥n ({{ preparingOrdersCount }})
              </button>
              <button class="filter-tab" [class.active]="orderFilter === 'ready'" (click)="orderFilter = 'ready'">
                Listos ({{ readyOrdersCount }})
              </button>
              <button class="filter-tab" [class.active]="orderFilter === 'delivered'" (click)="orderFilter = 'delivered'">
                Entregados ({{ deliveredOrdersCount }})
              </button>
            </div>
            <div class="filters-actions">
              <input
                type="text"
                class="search-input"
                placeholder="Buscar pedidos..."
                [(ngModel)]="searchTerm" />
              <div class="view-mode-toggle">
                <button 
                  class="view-mode-btn" 
                  [class.active]="orderViewMode === 'list'"
                  (click)="orderViewMode = 'list'"
                  title="Vista de lista">
                  <i class="bi bi-list-ul"></i>
                </button>
                <button 
                  class="view-mode-btn" 
                  [class.active]="orderViewMode === 'grid'"
                  (click)="orderViewMode = 'grid'"
                  title="Vista de cuadr√≠cula">
                  <i class="bi bi-grid-3x3-gap"></i>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Lista de Pedidos -->
        <div class="orders-container-admin" [ngClass]="'view-' + orderViewMode">
          <div *ngFor="let order of getFilteredOrders(); trackBy: trackByOrderId" 
               class="order-card-admin"
               [class.order-card-grid]="orderViewMode === 'grid'"
               [class.order-card-list]="orderViewMode === 'list'">
            <div class="order-header-admin">
              <div class="order-info-admin">
                <div class="order-id-row-admin">
                  <span class="order-id-admin">Pedido #{{ order.id.slice(-8) }}</span>
                  <span class="order-tracking-code-admin" *ngIf="order.trackingCode">
                    <i class="bi bi-qr-code me-1"></i>
                    {{ order.trackingCode }}
                  </span>
                </div>
                <span class="order-date-admin">{{ formatDate(order.date) }}</span>
                <div class="order-customer-info" *ngIf="order.userName || order.deliveryPhone || order.deliveryAddress">
                  <i class="bi bi-person me-1"></i>
                  <span *ngIf="order.userName" class="customer-name">{{ order.userName }}</span>
                  <span *ngIf="order.deliveryPhone && !order.userName">{{ order.deliveryPhone }}</span>
                  <span *ngIf="order.deliveryPhone && order.userName"> ‚Ä¢ {{ order.deliveryPhone }}</span>
                  <span *ngIf="order.deliveryAddress"> ‚Ä¢ {{ order.deliveryAddress }}</span>
                </div>
                <div class="order-type-badge" *ngIf="order.orderType">
                  <i class="bi" [class.bi-shop]="order.orderType === 'pickup'" [class.bi-truck]="order.orderType === 'delivery'"></i>
                  {{ order.orderType === 'pickup' ? 'Recoger en Restaurante' : 'Entrega a Domicilio' }}
                </div>
              </div>
              <span class="status-badge" [ngClass]="getOrderStatusClass(order.status)">
                {{ getOrderStatusText(order.status) }}
              </span>
            </div>

            <div class="order-items-admin" *ngIf="orderViewMode === 'list' || orderViewMode === 'grid'">
              <div *ngFor="let item of order.items; let itemIndex = index" 
                   class="order-item-admin"
                   [class.item-unavailable]="item.unavailable">
                <div class="item-details-admin">
                  <div class="item-main-info">
                    <span class="item-name-admin">
                      {{ item.name }}
                      <span class="unavailable-badge" *ngIf="item.unavailable">
                        <i class="bi bi-exclamation-triangle me-1"></i>
                        No Disponible
                      </span>
                    </span>
                    <span class="item-quantity-admin" *ngIf="!item.unavailable || item.quantity > 0">x{{ item.quantity }}</span>
                    <span class="item-price-admin" *ngIf="!item.unavailable || item.quantity > 0">${{ (item.price * item.quantity) | number }}</span>
                    <button class="btn-unavailable" 
                            *ngIf="!item.unavailable && order.status !== 'delivered' && order.status !== 'cancelled'"
                            (click)="markItemAsUnavailable(order, item, itemIndex)"
                            title="Marcar como no disponible">
                      <i class="bi bi-x-circle"></i>
                      No disponible
                    </button>
                  </div>
                  <div class="unavailable-reason" *ngIf="item.unavailable && item.unavailableReason">
                    <i class="bi bi-info-circle me-1"></i>
                    <span>{{ item.unavailableReason }}</span>
                  </div>
                  <div class="item-options-admin" *ngIf="item.selectedOptions && item.selectedOptions.length > 0">
                    <div *ngFor="let option of item.selectedOptions" class="option-badge-admin">
                      <i class="bi bi-plus-circle me-1"></i>
                      <span class="option-name">{{ option.name }}</span>
                      <span class="option-price" *ngIf="option.price > 0">+${{ option.price | number }}</span>
                    </div>
                  </div>
                  <div class="item-notes-admin" *ngIf="item.notes">
                    <i class="bi bi-chat-left-text me-1"></i>
                    <span>{{ item.notes }}</span>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Vista compacta para cuadr√≠cula -->
            <div class="order-items-compact" *ngIf="orderViewMode === 'grid'">
              <div class="items-count-badge">
                <i class="bi bi-bag-check me-1"></i>
                {{ order.items.length }} {{ order.items.length === 1 ? 'item' : 'items' }}
              </div>
              <div class="order-total-compact">
                <span class="total-label-compact">Total:</span>
                <span class="total-value-compact">${{ order.total | number }}</span>
              </div>
            </div>

            <div class="order-summary-admin" *ngIf="order.subtotal || order.additionalFees">
              <div class="summary-row" *ngIf="order.subtotal">
                <span>Subtotal:</span>
                <span>${{ (order.subtotal || 0) | number }}</span>
              </div>
              <div class="summary-row" *ngIf="order.additionalFees">
                <span>Costos adicionales:</span>
                <span>${{ (order.additionalFees || 0) | number }}</span>
              </div>
            </div>

            <div class="order-footer-admin">
              <div class="order-total-admin">
                <span class="total-label">Total:</span>
                <span class="total-value">${{ order.total | number }}</span>
              </div>
              <div class="order-actions-admin">
                <div class="action-buttons-group">
                  <button class="action-btn btn-view" (click)="viewOrderDetails(order)" title="Ver detalles">
                    <i class="bi bi-eye"></i>
                    <span *ngIf="orderViewMode === 'list'">Ver</span>
                  </button>
                  <button class="action-btn btn-print" (click)="printOrder(order)" title="Imprimir">
                    <i class="bi bi-printer"></i>
                    <span *ngIf="orderViewMode === 'list'">Imprimir</span>
                  </button>
                  <div class="status-select-wrapper">
                    <select class="status-select" [value]="order.status"
                            (change)="updateOrderStatus(order, $any($event.target).value)">
                      <option value="pending">‚è≥ Pendiente</option>
                      <option value="preparing">üë®‚Äçüç≥ Preparando</option>
                      <option value="ready">‚úÖ Listo</option>
                      <option value="delivered">üöö Entregado</option>
                      <option value="cancelled">‚ùå Cancelado</option>
                    </select>
                    <i class="bi bi-chevron-down status-select-icon"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Modal de Detalles del Pedido -->
        <div class="modal-overlay" *ngIf="showOrderDetailsModal && selectedOrder" (click)="closeOrderDetailsModal()">
          <div class="modal-content order-details-modal" (click)="$event.stopPropagation()">
            <div class="modal-header">
              <h3>Detalles del Pedido #{{ selectedOrder.id.slice(-8) }}</h3>
              <button class="modal-close-btn" (click)="closeOrderDetailsModal()">
                <i class="bi bi-x-lg"></i>
              </button>
            </div>
            <div class="modal-body">
              <div class="order-details-section">
                <h4>Informaci√≥n General</h4>
                <div class="details-grid">
                  <div class="detail-item">
                    <span class="detail-label">Fecha:</span>
                    <span class="detail-value">{{ formatDate(selectedOrder.date) }}</span>
                  </div>
                  <div class="detail-item">
                    <span class="detail-label">Cliente:</span>
                    <span class="detail-value">{{ selectedOrder.userName || 'N/A' }}</span>
                  </div>
                  <div class="detail-item">
                    <span class="detail-label">Estado:</span>
                    <span class="status-badge" [ngClass]="getOrderStatusClass(selectedOrder.status)">
                      {{ getOrderStatusText(selectedOrder.status) }}
                    </span>
                  </div>
                  <div class="detail-item">
                    <span class="detail-label">Tipo:</span>
                    <span class="detail-value">{{ selectedOrder.orderType === 'pickup' ? 'Recoger' : 'Entrega' }}</span>
                  </div>
                </div>
              </div>
              <div class="order-details-section">
                <h4>Items del Pedido</h4>
                <div class="order-items-admin">
                  <div *ngFor="let item of selectedOrder.items" class="order-item-admin">
                    <div class="item-details-admin">
                      <div class="item-main-info">
                        <span class="item-name-admin">{{ item.name }}</span>
                        <span class="item-quantity-admin">x{{ item.quantity }}</span>
                        <span class="item-price-admin">${{ (item.price * item.quantity) | number }}</span>
                      </div>
                      <div class="item-options-admin" *ngIf="item.selectedOptions && item.selectedOptions.length > 0">
                        <div *ngFor="let option of item.selectedOptions" class="option-badge-admin">
                          <i class="bi bi-plus-circle me-1"></i>
                          <span class="option-name">{{ option.name }}</span>
                          <span class="option-price" *ngIf="option.price > 0">+${{ option.price | number }}</span>
                        </div>
                      </div>
                      <div class="item-notes-admin" *ngIf="item.notes">
                        <i class="bi bi-chat-left-text me-1"></i>
                        <span>{{ item.notes }}</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="order-details-section" *ngIf="selectedOrder.subtotal || selectedOrder.additionalFees">
                <h4>Resumen Financiero</h4>
                <div class="order-summary-admin">
                  <div class="summary-row" *ngIf="selectedOrder.subtotal">
                    <span>Subtotal:</span>
                    <span>${{ (selectedOrder.subtotal || 0) | number }}</span>
                  </div>
                  <div class="summary-row" *ngIf="selectedOrder.additionalFees">
                    <span>Costos adicionales:</span>
                    <span>${{ (selectedOrder.additionalFees || 0) | number }}</span>
                  </div>
                  <div class="summary-row total-row">
                    <span>Total:</span>
                    <span class="total-value">${{ (selectedOrder.total || 0) | number }}</span>
                  </div>
                </div>
              </div>
            </div>
            <div class="modal-footer" *ngIf="selectedOrder">
              <button class="btn-primary" (click)="printOrder(selectedOrder)">
                <i class="bi bi-printer me-2"></i>
                Imprimir
              </button>
              <button class="btn-outline" (click)="closeOrderDetailsModal()">
                Cerrar
              </button>
            </div>
          </div>
        </div>

        <!-- Modal para Manejar Producto No Disponible -->
        <div class="modal-overlay" *ngIf="showUnavailableModal" (click)="closeUnavailableModal()">
          <div class="modal-content unavailable-modal" (click)="$event.stopPropagation()">
            <div class="modal-header">
              <h3>Producto No Disponible</h3>
              <button class="modal-close-btn" (click)="closeUnavailableModal()">
                <i class="bi bi-x-lg"></i>
              </button>
            </div>
            <div class="modal-body" *ngIf="selectedItemForUnavailable">
              <div class="unavailable-item-info">
                <p><strong>Producto:</strong> {{ selectedItemForUnavailable.item.name }}</p>
                <p><strong>Cantidad:</strong> {{ selectedItemForUnavailable.item.quantity }}</p>
                <p><strong>Pedido:</strong> #{{ selectedItemForUnavailable.order.id.slice(-8) }}</p>
              </div>
              
              <div class="unavailable-actions">
                <h4>¬øQu√© deseas hacer?</h4>
                
                <div class="action-option">
                  <button class="action-option-btn" (click)="handleUnavailableItem('cancel', 'Producto agotado')">
                    <i class="bi bi-x-circle"></i>
                    <div>
                      <strong>Cancelar Item</strong>
                      <small>Eliminar del pedido y ajustar el total</small>
                    </div>
                  </button>
                </div>
                
                <div class="action-option">
                  <button class="action-option-btn" (click)="handleUnavailableItem('notify', 'Producto no disponible temporalmente')">
                    <i class="bi bi-bell"></i>
                    <div>
                      <strong>Notificar al Cliente</strong>
                      <small>Marcar como no disponible y notificar al cliente</small>
                    </div>
                  </button>
                </div>
                
                <div class="action-option">
                  <button class="action-option-btn" (click)="handleUnavailableItem('replace', 'Producto reemplazado')">
                    <i class="bi bi-arrow-repeat"></i>
                    <div>
                      <strong>Reemplazar Producto</strong>
                      <small>Reemplazar con otro producto similar</small>
                    </div>
                  </button>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button class="btn-outline" (click)="closeUnavailableModal()">
                Cancelar
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Tab: Categor√≠as -->
      <div *ngIf="activeTab === 'categories'" class="tab-content">
        <div class="section-header">
          <h2 class="section-title">Gesti√≥n de Categor√≠as</h2>
          <div class="header-actions">
            <button class="btn-primary" (click)="openCategoryModal()">
              <i class="bi bi-plus-lg"></i>
              Agregar Categor√≠a
            </button>
          </div>
        </div>

        <div class="categories-grid">
          <div *ngFor="let category of categories" class="category-card-admin">
            <div class="category-icon-admin">
              <i [class]="'bi ' + category.icon"></i>
            </div>
            <h3 class="category-name-admin">{{ category.name }}</h3>
            <p class="category-description-admin">{{ category.description }}</p>
            <div class="category-actions">
              <button class="btn-icon-small" (click)="openCategoryModal(category)" title="Editar">
                <i class="bi bi-pencil"></i>
              </button>
              <button class="btn-icon-small btn-danger" (click)="deleteCategory(category.id)" title="Eliminar">
                <i class="bi bi-trash"></i>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Tab: Inventario -->
      <div *ngIf="activeTab === 'inventory'" class="tab-content">
        <div class="section-header">
          <h2 class="section-title">Gesti√≥n de Inventario</h2>
          <button class="btn-primary" (click)="openSupplyModal()">
            <i class="bi bi-plus-lg me-2"></i>
            Agregar Insumo
          </button>
        </div>

        <!-- Filtros -->
        <div class="filters-section">
          <div class="filter-tabs">
            <button class="filter-tab" [class.active]="supplyFilter === 'all'" (click)="supplyFilter = 'all'; loadSupplies()">
              Todos
            </button>
            <button class="filter-tab" [class.active]="supplyFilter === 'low'" (click)="supplyFilter = 'low'; loadSupplies()">
              Stock Bajo
            </button>
            <button class="filter-tab" [class.active]="supplyFilter === 'out'" (click)="supplyFilter = 'out'; loadSupplies()">
              Agotados
            </button>
          </div>
        </div>

        <!-- Lista de Insumos -->
        <div class="supplies-list">
          <div *ngFor="let supply of supplies" class="supply-card">
            <div class="supply-header">
              <div class="supply-info">
                <h3 class="supply-name">{{ supply.name }}</h3>
                <p class="supply-description">{{ supply.description }}</p>
              </div>
              <span class="stock-badge" [ngClass]="getStockStatusClass(supply.quantity)">
                <i class="bi" [class.bi-exclamation-triangle]="supply.quantity === 0 || supply.quantity < lowStockThreshold" 
                   [class.bi-check-circle]="supply.quantity >= lowStockThreshold"></i>
                {{ getStockStatusText(supply.quantity) }}
              </span>
            </div>
            <div class="supply-details">
              <div class="detail-item">
                <span class="detail-label">Cantidad:</span>
                <span class="detail-value" [ngClass]="getStockStatusClass(supply.quantity)">
                  {{ supply.quantity }}
                </span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Precio Unitario:</span>
                <span class="detail-value">${{ supply.unit_price | number }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Valor Total:</span>
                <span class="detail-value total-value">${{ (supply.quantity * supply.unit_price) | number }}</span>
              </div>
            </div>
            <div class="supply-actions">
              <button class="btn-icon-small" (click)="openSupplyModal(supply)" title="Editar">
                <i class="bi bi-pencil"></i>
              </button>
              <button class="btn-icon-small btn-danger" (click)="deleteSupply(supply._id || supply.id || '')" title="Eliminar">
                <i class="bi bi-trash"></i>
              </button>
            </div>
          </div>
        </div>

        <div *ngIf="supplies.length === 0" class="empty-state">
          <i class="bi bi-inbox empty-icon"></i>
          <h3>No hay insumos registrados</h3>
          <p>Agrega insumos para gestionar tu inventario</p>
          <button class="btn-primary" (click)="openSupplyModal()">
            <i class="bi bi-plus-lg me-2"></i>
            Agregar Primer Insumo
          </button>
        </div>
      </div>

      <!-- Tab: Reservas -->
      <div *ngIf="activeTab === 'reservations'" class="tab-content">
        <div class="section-header">
          <h2 class="section-title">Gesti√≥n de Reservas</h2>
        </div>

        <!-- Filtros y Controles -->
        <div class="filters-section">
          <div class="filters-top-row">
            <div class="filter-tabs">
              <button class="filter-tab" [class.active]="reservationFilter === 'all'" (click)="reservationFilter = 'all'">
                Todas ({{ reservations.length }})
              </button>
              <button class="filter-tab" [class.active]="reservationFilter === 'pending'" (click)="reservationFilter = 'pending'">
                Pendientes ({{ pendingReservationsCount }})
              </button>
              <button class="filter-tab" [class.active]="reservationFilter === 'confirmed'" (click)="reservationFilter = 'confirmed'">
                Confirmadas ({{ confirmedReservationsCount }})
              </button>
              <button class="filter-tab" [class.active]="reservationFilter === 'cancelled'" (click)="reservationFilter = 'cancelled'">
                Canceladas ({{ cancelledReservationsCount }})
              </button>
              <button class="filter-tab" [class.active]="reservationFilter === 'completed'" (click)="reservationFilter = 'completed'">
                Completadas ({{ completedReservationsCount }})
              </button>
            </div>
            <div class="filters-actions">
              <input
                type="text"
                class="search-input"
                placeholder="Buscar reservas..."
                [(ngModel)]="searchTerm" />
            </div>
          </div>
        </div>

        <!-- Lista de Reservas -->
        <div class="reservations-container-admin">
          <div *ngFor="let reservation of getFilteredReservations()" class="reservation-card-admin">
            <div class="reservation-header-admin">
              <div class="reservation-info-admin">
                <div class="reservation-id-row-admin">
                  <span class="reservation-id-admin">Mesa {{ reservation.tableNumber }}</span>
                  <span class="reservation-date-admin">
                    <i class="bi bi-calendar3 me-1"></i>
                    {{ reservation.date }}
                  </span>
                  <span class="reservation-time-admin">
                    <i class="bi bi-clock me-1"></i>
                    {{ reservation.time }}
                  </span>
                </div>
                <div class="reservation-customer-info">
                  <i class="bi bi-person me-1"></i>
                  <span class="customer-name">{{ reservation.userName }}</span>
                  <span class="customer-email"> ‚Ä¢ {{ reservation.userEmail }}</span>
                </div>
                <div class="reservation-people-info">
                  <i class="bi bi-people me-1"></i>
                  <span>{{ reservation.numberOfPeople }} {{ reservation.numberOfPeople === 1 ? 'persona' : 'personas' }}</span>
                </div>
                <div class="reservation-special-requests" *ngIf="reservation.specialRequests">
                  <i class="bi bi-chat-left-text me-1"></i>
                  <span>{{ reservation.specialRequests }}</span>
                </div>
              </div>
              <span class="status-badge" [ngClass]="getReservationStatusClass(reservation.status)">
                {{ getReservationStatusText(reservation.status) }}
              </span>
            </div>

            <div class="reservation-actions-admin">
              <button 
                class="btn-success" 
                *ngIf="reservation.status === 'pending'"
                (click)="confirmReservation(reservation)"
                title="Confirmar reserva">
                <i class="bi bi-check-circle me-1"></i>
                Confirmar
              </button>
              <button 
                class="btn-warning" 
                *ngIf="reservation.status === 'pending' || reservation.status === 'confirmed'"
                (click)="openCancelReservationModal(reservation)"
                title="Cancelar reserva">
                <i class="bi bi-x-circle me-1"></i>
                Cancelar
              </button>
              <button 
                class="btn-info" 
                *ngIf="reservation.status === 'confirmed'"
                (click)="completeReservation(reservation)"
                title="Marcar como completada">
                <i class="bi bi-check2-all me-1"></i>
                Completar
              </button>
              <span class="reservation-created-date" *ngIf="reservation.createdAt">
                Creada: {{ formatDate(reservation.createdAt) }}
              </span>
            </div>
          </div>
        </div>

        <div *ngIf="getFilteredReservations().length === 0" class="empty-state">
          <i class="bi bi-calendar-x empty-icon"></i>
          <h3>No hay reservas</h3>
          <p *ngIf="reservationFilter !== 'all'">No hay reservas con el estado seleccionado</p>
          <p *ngIf="reservationFilter === 'all'">A√∫n no se han realizado reservas</p>
        </div>
      </div>

      <!-- Tab: Configuraci√≥n -->
      <div *ngIf="activeTab === 'settings'" class="tab-content">
        <h2 class="section-title">Configuraci√≥n</h2>

        <form [formGroup]="settingsForm" (ngSubmit)="onSettingsSubmit()" class="settings-form">
          <!-- Informaci√≥n General -->
          <div class="settings-section">
            <h3 class="settings-section-title">
              <i class="bi bi-info-circle"></i>
              Informaci√≥n General
            </h3>
            <div class="settings-grid">
              <div class="form-group">
                <label class="form-label">Nombre del Restaurante</label>
                <input type="text" formControlName="restaurantName" class="form-control" />
              </div>
              <div class="form-group">
                <label class="form-label">Email de Contacto</label>
                <input type="email" formControlName="email" class="form-control" />
              </div>
              <div class="form-group">
                <label class="form-label">Tel√©fono</label>
                <input type="tel" formControlName="phone" class="form-control" />
              </div>
              <div class="form-group">
                <label class="form-label">Direcci√≥n</label>
                <input type="text" formControlName="address" class="form-control" />
              </div>
            </div>
          </div>

          <!-- Horarios -->
          <div class="settings-section">
            <h3 class="settings-section-title">
              <i class="bi bi-clock"></i>
              Horarios de Atenci√≥n
            </h3>
            <div class="settings-grid">
              <div class="form-group">
                <label class="form-label">Hora de Apertura</label>
                <input type="time" formControlName="openingTime" class="form-control" />
              </div>
              <div class="form-group">
                <label class="form-label">Hora de Cierre</label>
                <input type="time" formControlName="closingTime" class="form-control" />
              </div>
            </div>
          </div>

          <!-- Opciones de Servicio -->
          <div class="settings-section">
            <h3 class="settings-section-title">
              <i class="bi bi-truck"></i>
              Opciones de Servicio
            </h3>
            <div class="settings-grid">
              <div class="form-group">
                <label class="checkbox-label">
                  <input type="checkbox" formControlName="deliveryEnabled" />
                  <span>Habilitar Delivery</span>
                </label>
              </div>
              <div class="form-group">
                <label class="checkbox-label">
                  <input type="checkbox" formControlName="pickupEnabled" />
                  <span>Habilitar Recoger en Tienda</span>
                </label>
              </div>
            </div>
          </div>

          <!-- Configuraci√≥n de Pedidos -->
          <div class="settings-section">
            <h3 class="settings-section-title">
              <i class="bi bi-gear"></i>
              Configuraci√≥n de Pedidos
            </h3>
            <div class="settings-grid">
              <div class="form-group">
                <label class="form-label">Tasa de Impuesto (%)</label>
                <input type="number" formControlName="taxRate" class="form-control" min="0" max="100" />
              </div>
              <div class="form-group">
                <label class="form-label">Monto M√≠nimo de Pedido</label>
                <input type="number" formControlName="minOrderAmount" class="form-control" min="0" />
              </div>
              <div class="form-group">
                <label class="form-label">Costo de Delivery</label>
                <input type="number" formControlName="deliveryFee" class="form-control" min="0" />
              </div>
              <div class="form-group">
                <label class="form-label">Distancia M√°xima de Delivery (km)</label>
                <input type="number" formControlName="maxDeliveryDistance" class="form-control" min="1" />
              </div>
            </div>
          </div>

          <!-- Botones de Acci√≥n -->
          <div class="settings-actions">
            <button type="button" class="btn-outline" (click)="settingsForm.reset()">
              <i class="bi bi-arrow-counterclockwise"></i>
              Restablecer
            </button>
            <button type="submit" class="btn-primary">
              <i class="bi bi-check-lg"></i>
              Guardar Configuraci√≥n
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal: Agregar/Editar Producto -->
  <div *ngIf="showProductModal" class="modal-overlay" (click)="closeProductModal()">
    <div class="modal-content modal-large" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3 class="modal-title">{{ selectedProduct ? 'Editar Producto' : 'Agregar Nuevo Producto' }}</h3>
        <button class="modal-close" (click)="closeProductModal()">
          <i class="bi bi-x-lg"></i>
        </button>
      </div>
      <form [formGroup]="productForm" (ngSubmit)="saveProduct()" class="modal-form">
        <div class="form-group">
          <label class="form-label">Nombre del Producto</label>
          <input type="text" formControlName="name" class="form-control" />
        </div>
        <div class="form-group">
          <label class="form-label">Descripci√≥n</label>
          <textarea formControlName="description" class="form-control" rows="3"></textarea>
        </div>
        <div class="form-group">
          <label class="form-label">URL de la Imagen</label>
          <input type="url" formControlName="imageUrl" class="form-control" placeholder="https://ejemplo.com/imagen.jpg" />
          <small class="form-text text-muted">Ingresa la URL completa de la imagen del producto</small>
        </div>
        <div class="row g-3">
          <div class="col-md-6">
            <div class="form-group">
              <label class="form-label">Precio</label>
              <input type="number" formControlName="price" class="form-control" />
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label class="form-label">Categor√≠a</label>
              <select formControlName="categoryId" class="form-control">
                <option value="">Seleccionar categor√≠a</option>
                <option *ngFor="let cat of categories" [value]="cat.id">{{ cat.name }}</option>
              </select>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" formControlName="available" />
            <span>Producto disponible</span>
          </label>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn-outline" (click)="closeProductModal()">Cancelar</button>
          <button type="submit" class="btn-primary">Guardar</button>
        </div>
      </form>
    </div>
  </div>
  </div>

  <!-- Modal: Categor√≠a -->
  <div *ngIf="showCategoryModal" class="modal-overlay" (click)="closeCategoryModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3 class="modal-title">{{ selectedCategory ? 'Editar Categor√≠a' : 'Agregar Nueva Categor√≠a' }}</h3>
        <button class="modal-close" (click)="closeCategoryModal()">
          <i class="bi bi-x-lg"></i>
        </button>
      </div>
      <form [formGroup]="categoryForm" (ngSubmit)="saveCategory()">
        <div class="form-group">
          <label class="form-label">Nombre de la Categor√≠a</label>
          <input type="text" formControlName="name" class="form-control" placeholder="Ej: Hamburguesas" />
        </div>
        <div class="form-group">
          <label class="form-label">Descripci√≥n</label>
          <textarea formControlName="description" class="form-control" rows="3" placeholder="Descripci√≥n de la categor√≠a"></textarea>
        </div>
        <div class="form-group">
          <label class="form-label">URL de la Imagen (Opcional)</label>
          <input type="url" formControlName="imageUrl" class="form-control" placeholder="https://ejemplo.com/imagen.jpg" />
          <small class="form-text text-muted">URL de una imagen que represente esta categor√≠a. Si no se proporciona, se usar√° una imagen por defecto.</small>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn-outline" (click)="closeCategoryModal()">Cancelar</button>
          <button type="submit" class="btn-primary">Guardar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal de Insumo -->
  <div class="modal-overlay" *ngIf="showSupplyModal" (click)="closeSupplyModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>{{ selectedSupply ? 'Editar Insumo' : 'Nuevo Insumo' }}</h3>
        <button class="modal-close-btn" (click)="closeSupplyModal()">
          <i class="bi bi-x-lg"></i>
        </button>
      </div>
      <form [formGroup]="supplyForm" (ngSubmit)="saveSupply()" class="modal-body">
        <div class="form-group">
          <label class="form-label">Nombre del Insumo</label>
          <input type="text" formControlName="name" class="form-control" placeholder="Ej: Harina, Aceite, etc." />
          <div *ngIf="supplyForm.get('name')?.invalid && supplyForm.get('name')?.touched" class="error-message">
            El nombre es requerido y debe tener al menos 3 caracteres
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Descripci√≥n</label>
          <textarea formControlName="description" class="form-control" rows="3" placeholder="Descripci√≥n del insumo"></textarea>
          <div *ngIf="supplyForm.get('description')?.invalid && supplyForm.get('description')?.touched" class="error-message">
            La descripci√≥n es requerida y debe tener al menos 10 caracteres
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Precio Unitario</label>
            <input type="number" formControlName="unit_price" class="form-control" min="0" step="0.01" />
            <div *ngIf="supplyForm.get('unit_price')?.invalid && supplyForm.get('unit_price')?.touched" class="error-message">
              El precio debe ser mayor o igual a 0
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Cantidad</label>
            <input type="number" formControlName="quantity" class="form-control" min="0" />
            <div *ngIf="supplyForm.get('quantity')?.invalid && supplyForm.get('quantity')?.touched" class="error-message">
              La cantidad debe ser mayor o igual a 0
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn-outline" (click)="closeSupplyModal()">
            Cancelar
          </button>
          <button type="submit" class="btn-primary" [disabled]="supplyForm.invalid">
            {{ selectedSupply ? 'Actualizar' : 'Crear' }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal: Cancelar Reserva -->
  <div *ngIf="showCancelReservationModal && selectedReservation" class="modal-overlay" (click)="closeCancelReservationModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3 class="modal-title">Cancelar Reserva</h3>
        <button class="modal-close" (click)="closeCancelReservationModal()">
          <i class="bi bi-x-lg"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="reservation-details-modal">
          <p><strong>Mesa:</strong> {{ selectedReservation.tableNumber }}</p>
          <p><strong>Fecha:</strong> {{ selectedReservation.date }}</p>
          <p><strong>Hora:</strong> {{ selectedReservation.time }}</p>
          <p><strong>Cliente:</strong> {{ selectedReservation.userName }} ({{ selectedReservation.userEmail }})</p>
          <p><strong>Personas:</strong> {{ selectedReservation.numberOfPeople }}</p>
        </div>
        <div class="form-group">
          <label class="form-label">Motivo de cancelaci√≥n (opcional)</label>
          <textarea 
            [(ngModel)]="cancelReason" 
            class="form-control" 
            rows="3" 
            placeholder="Ej: Mesa no disponible, cambio de horario, etc. Este mensaje se enviar√° al cliente."></textarea>
          <small class="form-text text-muted">Si no especificas un motivo, se usar√° un mensaje por defecto.</small>
        </div>
        <div class="alert alert-warning">
          <i class="bi bi-exclamation-triangle me-2"></i>
          <strong>Importante:</strong> Al cancelar esta reserva, el cliente ser√° notificado autom√°ticamente.
        </div>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn-outline" (click)="closeCancelReservationModal()">Cerrar</button>
        <button type="button" class="btn-warning" (click)="cancelReservation()">
          <i class="bi bi-x-circle me-1"></i>
          Confirmar Cancelaci√≥n
        </button>
      </div>
    </div>
  </div>
</section>

