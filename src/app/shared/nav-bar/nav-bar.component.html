<nav class="navbar navbar-expand-lg glass-navbar fixed-top">
  <div class="container">
    <a class="navbar-brand fw-bold" type="button" (click)="navigateTo('/')">
      PRESTEZA
    </a>

    <!-- MI CUENTA siempre visible en el header (a la derecha) -->
    <div class="header-account">
      <!-- Overlay sutil cuando el modal está abierto -->
      <div *ngIf="showLoginModal" class="login-overlay-backdrop" (click)="closeLoginModal()"></div>

      <a class="account-btn header-account-btn" role="button" (click)="onAccountClick($event)">
        <i class="bi bi-person-circle"></i>
        <span *ngIf="isAuthenticated && isAdmin">ADMIN</span>
        <span *ngIf="isAuthenticated && !isAdmin && userName">{{ userName }}</span>
        <span *ngIf="!isAuthenticated">MI CUENTA</span>
      </a>

      <!-- Dropdown del Usuario Autenticado -->
      <div *ngIf="showUserDropdown" class="user-dropdown" (click)="$event.stopPropagation()">
        <div class="user-dropdown-content">
          <div class="user-dropdown-header">
            <div class="user-dropdown-avatar">
              <i class="bi bi-person-circle"></i>
            </div>
            <div class="user-dropdown-info">
              <p class="user-dropdown-name">{{ userName }}</p>
              <p class="user-dropdown-email">{{ userEmail }}</p>
            </div>
          </div>
          <div class="user-dropdown-divider"></div>
          <button class="user-dropdown-item" (click)="navigateToProfile()">
            <i class="bi bi-person"></i>
            <span>Mi Perfil</span>
          </button>
          <div class="user-dropdown-divider"></div>
          <button class="user-dropdown-item user-dropdown-logout" (click)="logout()">
            <i class="bi bi-box-arrow-right"></i>
            <span>Cerrar Sesión</span>
          </button>
        </div>
      </div>

      <!-- Modal de Inicio de Sesión -->
      <div *ngIf="showLoginModal" class="login-modal-dropdown" [class.login-modal-centered]="isOnRegistroPage" (click)="$event.stopPropagation()">
        <div class="login-modal">
          <button class="login-modal-close" (click)="closeLoginModal()">
            <i class="bi bi-x-lg"></i>
          </button>
          <div class="login-modal-header">
            <div class="login-modal-icon-wrapper">
              <i class="bi bi-person-circle"></i>
            </div>
            <h2 class="login-modal-title">Iniciar Sesión</h2>
          </div>
          <form class="login-modal-form" (ngSubmit)="onLoginSubmit()">
            <!-- Mensaje de error -->
            <div *ngIf="loginError" class="alert alert-danger alert-dismissible fade show" role="alert">
              <i class="bi bi-exclamation-triangle-fill me-2"></i>
              {{ loginError }}
              <button type="button" class="btn-close" (click)="loginError = null" aria-label="Close"></button>
            </div>

            <div class="form-group">
              <label for="email" class="form-label">
                <i class="bi bi-envelope-fill"></i>
              </label>
              <input
                type="email"
                id="email"
                class="form-control"
                placeholder="tu@email.com"
                [(ngModel)]="loginEmail"
                name="email"
                required
                [disabled]="isLoading"
              />
            </div>
            <div class="form-group">
              <label for="password" class="form-label">
                <i class="bi bi-lock-fill"></i>
              </label>
              <input
                type="password"
                id="password"
                class="form-control"
                placeholder="Ingresa tu contraseña"
                [(ngModel)]="loginPassword"
                name="password"
                required
                [disabled]="isLoading"
              />
            </div>
            <div class="login-modal-options">
              <a href="/forgot-password" class="forgot-password" (click)="onForgotPassword($event)">¿Olvidaste tu contraseña?</a>
            </div>
            <button type="submit" class="login-submit-btn" [disabled]="isLoading">
              <span *ngIf="!isLoading">Iniciar Sesión</span>
              <span *ngIf="isLoading">
                <i class="bi bi-hourglass-split"></i>
                Cargando...
              </span>
              <i *ngIf="!isLoading" class="bi bi-arrow-right"></i>
            </button>
          </form>
          <div class="login-modal-footer">
            <button class="register-btn" (click)="navigateToRegistro()">
              ¿No tienes una cuenta? <strong>Regístrate aquí</strong>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Carrito siempre visible en el header (móvil) -->
    <div class="header-cart d-lg-none">
      <app-cart></app-cart>
    </div>

    <!-- Botón toggler para móviles -->
    <button
      class="navbar-toggler"
      type="button"
      (click)="toggleNavbar()"
      [attr.aria-expanded]="!isNavbarCollapsed"
      aria-controls="navbarNav"
      aria-label="Toggle navigation">
      <i class="bi bi-list"></i>
    </button>

    <!-- Contenido colapsable -->
    <div class="navbar-collapse justify-content-end"
         [class.show]="!isNavbarCollapsed"
         [class.collapse]="isNavbarCollapsed"
         id="navbarNav">
      <ul class="navbar-nav align-items-center gap-4">
        <li class="nav-item">
          <a class="nav-link" role="button" (click)="navigateTo('/')">INICIO</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" role="button" (click)="navigateTo('/menu')"
            >MENÚ</a
          >
        </li>
        <li class="nav-item">
          <a
            class="nav-link"
            role="button"
            aria-expanded="false"
            (click)="navigateTo('/sede')"
          >
            NUESTRA SEDE
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" role="button" (click)="navigateTo('/nosotros')"
            >NOSOTROS</a
          >
        </li>
        <li class="nav-item">
          <a class="nav-link" role="button" (click)="navigateTo('/contacto')">CONTACTO</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" role="button" (click)="navigateTo('/reservas')">RESERVAS</a>
        </li>

        <!-- carrito en el menú -->
        <li class="nav-item d-none d-lg-flex align-items-center">
          <app-cart></app-cart>
        </li>
      </ul>
    </div>
  </div>
</nav>
